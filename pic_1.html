<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<script src="data:application/x-javascript;base64,KGZ1bmN0aW9uKCkgewogIC8vIElmIHdpbmRvdy5IVE1MV2lkZ2V0cyBpcyBhbHJlYWR5IGRlZmluZWQsIHRoZW4gdXNlIGl0OyBvdGhlcndpc2UgY3JlYXRlIGEKICAvLyBuZXcgb2JqZWN0LiBUaGlzIGFsbG93cyBwcmVjZWRpbmcgY29kZSB0byBzZXQgb3B0aW9ucyB0aGF0IGFmZmVjdCB0aGUKICAvLyBpbml0aWFsaXphdGlvbiBwcm9jZXNzICh0aG91Z2ggbm9uZSBjdXJyZW50bHkgZXhpc3QpLgogIHdpbmRvdy5IVE1MV2lkZ2V0cyA9IHdpbmRvdy5IVE1MV2lkZ2V0cyB8fCB7fTsKCiAgLy8gU2VlIGlmIHdlJ3JlIHJ1bm5pbmcgaW4gYSB2aWV3ZXIgcGFuZS4gSWYgbm90LCB3ZSdyZSBpbiBhIHdlYiBicm93c2VyLgogIHZhciB2aWV3ZXJNb2RlID0gd2luZG93LkhUTUxXaWRnZXRzLnZpZXdlck1vZGUgPQogICAgICAvXGJ2aWV3ZXJfcGFuZT0xXGIvLnRlc3Qod2luZG93LmxvY2F0aW9uKTsKCiAgLy8gU2VlIGlmIHdlJ3JlIHJ1bm5pbmcgaW4gU2hpbnkgbW9kZS4gSWYgbm90LCBpdCdzIGEgc3RhdGljIGRvY3VtZW50LgogIC8vIE5vdGUgdGhhdCBzdGF0aWMgd2lkZ2V0cyBjYW4gYXBwZWFyIGluIGJvdGggU2hpbnkgYW5kIHN0YXRpYyBtb2RlcywgYnV0CiAgLy8gb2J2aW91c2x5LCBTaGlueSB3aWRnZXRzIGNhbiBvbmx5IGFwcGVhciBpbiBTaGlueSBhcHBzL2RvY3VtZW50cy4KICB2YXIgc2hpbnlNb2RlID0gd2luZG93LkhUTUxXaWRnZXRzLnNoaW55TW9kZSA9CiAgICAgIHR5cGVvZih3aW5kb3cuU2hpbnkpICE9PSAidW5kZWZpbmVkIiAmJiAhIXdpbmRvdy5TaGlueS5vdXRwdXRCaW5kaW5nczsKCiAgLy8gV2UgY2FuJ3QgY291bnQgb24galF1ZXJ5IGJlaW5nIGF2YWlsYWJsZSwgc28gd2UgaW1wbGVtZW50IG91ciBvd24KICAvLyB2ZXJzaW9uIGlmIG5lY2Vzc2FyeS4KICBmdW5jdGlvbiBxdWVyeVNlbGVjdG9yQWxsKHNjb3BlLCBzZWxlY3RvcikgewogICAgaWYgKHR5cGVvZihqUXVlcnkpICE9PSAidW5kZWZpbmVkIiAmJiBzY29wZSBpbnN0YW5jZW9mIGpRdWVyeSkgewogICAgICByZXR1cm4gc2NvcGUuZmluZChzZWxlY3Rvcik7CiAgICB9CiAgICBpZiAoc2NvcGUucXVlcnlTZWxlY3RvckFsbCkgewogICAgICByZXR1cm4gc2NvcGUucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBhc0FycmF5KHZhbHVlKSB7CiAgICBpZiAodmFsdWUgPT09IG51bGwpCiAgICAgIHJldHVybiBbXTsKICAgIGlmICgkLmlzQXJyYXkodmFsdWUpKQogICAgICByZXR1cm4gdmFsdWU7CiAgICByZXR1cm4gW3ZhbHVlXTsKICB9CgogIC8vIEltcGxlbWVudCBqUXVlcnkncyBleHRlbmQKICBmdW5jdGlvbiBleHRlbmQodGFyZ2V0IC8qLCAuLi4gKi8pIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDEpIHsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07CiAgICAgIGZvciAodmFyIHByb3AgaW4gc291cmNlKSB7CiAgICAgICAgaWYgKHNvdXJjZS5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgewogICAgICAgICAgdGFyZ2V0W3Byb3BdID0gc291cmNlW3Byb3BdOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHRhcmdldDsKICB9CgogIC8vIElFOCBkb2Vzbid0IHN1cHBvcnQgQXJyYXkuZm9yRWFjaC4KICBmdW5jdGlvbiBmb3JFYWNoKHZhbHVlcywgY2FsbGJhY2ssIHRoaXNBcmcpIHsKICAgIGlmICh2YWx1ZXMuZm9yRWFjaCkgewogICAgICB2YWx1ZXMuZm9yRWFjaChjYWxsYmFjaywgdGhpc0FyZyk7CiAgICB9IGVsc2UgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNhbGxiYWNrLmNhbGwodGhpc0FyZywgdmFsdWVzW2ldLCBpLCB2YWx1ZXMpOwogICAgICB9CiAgICB9CiAgfQoKICAvLyBSZXBsYWNlcyB0aGUgc3BlY2lmaWVkIG1ldGhvZCB3aXRoIHRoZSByZXR1cm4gdmFsdWUgb2YgZnVuY1NvdXJjZS4KICAvLwogIC8vIE5vdGUgdGhhdCBmdW5jU291cmNlIHNob3VsZCBub3QgQkUgdGhlIG5ldyBtZXRob2QsIGl0IHNob3VsZCBiZSBhIGZ1bmN0aW9uCiAgLy8gdGhhdCBSRVRVUk5TIHRoZSBuZXcgbWV0aG9kLiBmdW5jU291cmNlIHJlY2VpdmVzIGEgc2luZ2xlIGFyZ3VtZW50IHRoYXQgaXMKICAvLyB0aGUgb3ZlcnJpZGRlbiBtZXRob2QsIGl0IGNhbiBiZSBjYWxsZWQgZnJvbSB0aGUgbmV3IG1ldGhvZC4gVGhlIG92ZXJyaWRkZW4KICAvLyBtZXRob2QgY2FuIGJlIGNhbGxlZCBsaWtlIGEgcmVndWxhciBmdW5jdGlvbiwgaXQgaGFzIHRoZSB0YXJnZXQgcGVybWFuZW50bHkKICAvLyBib3VuZCB0byBpdCBzbyAidGhpcyIgd2lsbCB3b3JrIGNvcnJlY3RseS4KICBmdW5jdGlvbiBvdmVycmlkZU1ldGhvZCh0YXJnZXQsIG1ldGhvZE5hbWUsIGZ1bmNTb3VyY2UpIHsKICAgIHZhciBzdXBlckZ1bmMgPSB0YXJnZXRbbWV0aG9kTmFtZV0gfHwgZnVuY3Rpb24oKSB7fTsKICAgIHZhciBzdXBlckZ1bmNCb3VuZCA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gc3VwZXJGdW5jLmFwcGx5KHRhcmdldCwgYXJndW1lbnRzKTsKICAgIH07CiAgICB0YXJnZXRbbWV0aG9kTmFtZV0gPSBmdW5jU291cmNlKHN1cGVyRnVuY0JvdW5kKTsKICB9CgogIC8vIEFkZCBhIG1ldGhvZCB0byBkZWxlZ2F0b3IgdGhhdCwgd2hlbiBpbnZva2VkLCBjYWxscwogIC8vIGRlbGVnYXRlZS5tZXRob2ROYW1lLiBJZiB0aGVyZSBpcyBubyBzdWNoIG1ldGhvZCBvbgogIC8vIHRoZSBkZWxlZ2F0ZWUsIGJ1dCB0aGVyZSB3YXMgb25lIG9uIGRlbGVnYXRvciBiZWZvcmUKICAvLyBkZWxlZ2F0ZU1ldGhvZCB3YXMgY2FsbGVkLCB0aGVuIHRoZSBvcmlnaW5hbCB2ZXJzaW9uCiAgLy8gaXMgaW52b2tlZCBpbnN0ZWFkLgogIC8vIEZvciBleGFtcGxlOgogIC8vCiAgLy8gdmFyIGEgPSB7CiAgLy8gICBtZXRob2QxOiBmdW5jdGlvbigpIHsgY29uc29sZS5sb2coJ2ExJyk7IH0KICAvLyAgIG1ldGhvZDI6IGZ1bmN0aW9uKCkgeyBjb25zb2xlLmxvZygnYTInKTsgfQogIC8vIH07CiAgLy8gdmFyIGIgPSB7CiAgLy8gICBtZXRob2QxOiBmdW5jdGlvbigpIHsgY29uc29sZS5sb2coJ2IxJyk7IH0KICAvLyB9OwogIC8vIGRlbGVnYXRlTWV0aG9kKGEsIGIsICJtZXRob2QxIik7CiAgLy8gZGVsZWdhdGVNZXRob2QoYSwgYiwgIm1ldGhvZDIiKTsKICAvLyBhLm1ldGhvZDEoKTsKICAvLyBhLm1ldGhvZDIoKTsKICAvLwogIC8vIFRoZSBvdXRwdXQgd291bGQgYmUgImIxIiwgImEyIi4KICBmdW5jdGlvbiBkZWxlZ2F0ZU1ldGhvZChkZWxlZ2F0b3IsIGRlbGVnYXRlZSwgbWV0aG9kTmFtZSkgewogICAgdmFyIGluaGVyaXRlZCA9IGRlbGVnYXRvclttZXRob2ROYW1lXTsKICAgIGRlbGVnYXRvclttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgdGFyZ2V0ID0gZGVsZWdhdGVlOwogICAgICB2YXIgbWV0aG9kID0gZGVsZWdhdGVlW21ldGhvZE5hbWVdOwoKICAgICAgLy8gVGhlIG1ldGhvZCBkb2Vzbid0IGV4aXN0IG9uIHRoZSBkZWxlZ2F0ZWUuIEluc3RlYWQsCiAgICAgIC8vIGNhbGwgdGhlIG1ldGhvZCBvbiB0aGUgZGVsZWdhdG9yLCBpZiBpdCBleGlzdHMuCiAgICAgIGlmICghbWV0aG9kKSB7CiAgICAgICAgdGFyZ2V0ID0gZGVsZWdhdG9yOwogICAgICAgIG1ldGhvZCA9IGluaGVyaXRlZDsKICAgICAgfQoKICAgICAgaWYgKG1ldGhvZCkgewogICAgICAgIHJldHVybiBtZXRob2QuYXBwbHkodGFyZ2V0LCBhcmd1bWVudHMpOwogICAgICB9CiAgICB9OwogIH0KCiAgLy8gSW1wbGVtZW50IGEgdmFndWUgZmFjc2ltaWxpZSBvZiBqUXVlcnkncyBkYXRhIG1ldGhvZAogIGZ1bmN0aW9uIGVsZW1lbnREYXRhKGVsLCBuYW1lLCB2YWx1ZSkgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMikgewogICAgICByZXR1cm4gZWxbImh0bWx3aWRnZXRfZGF0YV8iICsgbmFtZV07CiAgICB9IGVsc2UgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMykgewogICAgICBlbFsiaHRtbHdpZGdldF9kYXRhXyIgKyBuYW1lXSA9IHZhbHVlOwogICAgICByZXR1cm4gZWw7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIldyb25nIG51bWJlciBvZiBhcmd1bWVudHMgZm9yIGVsZW1lbnREYXRhOiAiICsKICAgICAgICBhcmd1bWVudHMubGVuZ3RoKTsKICAgIH0KICB9CgogIC8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMzQ0NjE3MC9lc2NhcGUtc3RyaW5nLWZvci11c2UtaW4tamF2YXNjcmlwdC1yZWdleAogIGZ1bmN0aW9uIGVzY2FwZVJlZ0V4cChzdHIpIHsKICAgIHJldHVybiBzdHIucmVwbGFjZSgvW1wtXFtcXVwvXHtcfVwoXClcKlwrXD9cLlxcXF5cJFx8XS9nLCAiXFwkJiIpOwogIH0KCiAgZnVuY3Rpb24gaGFzQ2xhc3MoZWwsIGNsYXNzTmFtZSkgewogICAgdmFyIHJlID0gbmV3IFJlZ0V4cCgiXFxiIiArIGVzY2FwZVJlZ0V4cChjbGFzc05hbWUpICsgIlxcYiIpOwogICAgcmV0dXJuIHJlLnRlc3QoZWwuY2xhc3NOYW1lKTsKICB9CgogIC8vIGVsZW1lbnRzIC0gYXJyYXkgKG9yIGFycmF5LWxpa2Ugb2JqZWN0KSBvZiBIVE1MIGVsZW1lbnRzCiAgLy8gY2xhc3NOYW1lIC0gY2xhc3MgbmFtZSB0byB0ZXN0IGZvcgogIC8vIGluY2x1ZGUgLSBpZiB0cnVlLCBvbmx5IHJldHVybiBlbGVtZW50cyB3aXRoIGdpdmVuIGNsYXNzTmFtZTsKICAvLyAgIGlmIGZhbHNlLCBvbmx5IHJldHVybiBlbGVtZW50cyAqd2l0aG91dCogZ2l2ZW4gY2xhc3NOYW1lCiAgZnVuY3Rpb24gZmlsdGVyQnlDbGFzcyhlbGVtZW50cywgY2xhc3NOYW1lLCBpbmNsdWRlKSB7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykgewogICAgICBpZiAoaGFzQ2xhc3MoZWxlbWVudHNbaV0sIGNsYXNzTmFtZSkgPT0gaW5jbHVkZSkKICAgICAgICByZXN1bHRzLnB1c2goZWxlbWVudHNbaV0pOwogICAgfQogICAgcmV0dXJuIHJlc3VsdHM7CiAgfQoKICBmdW5jdGlvbiBvbihvYmosIGV2ZW50TmFtZSwgZnVuYykgewogICAgaWYgKG9iai5hZGRFdmVudExpc3RlbmVyKSB7CiAgICAgIG9iai5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuYywgZmFsc2UpOwogICAgfSBlbHNlIGlmIChvYmouYXR0YWNoRXZlbnQpIHsKICAgICAgb2JqLmF0dGFjaEV2ZW50KGV2ZW50TmFtZSwgZnVuYyk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBvZmYob2JqLCBldmVudE5hbWUsIGZ1bmMpIHsKICAgIGlmIChvYmoucmVtb3ZlRXZlbnRMaXN0ZW5lcikKICAgICAgb2JqLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBmdW5jLCBmYWxzZSk7CiAgICBlbHNlIGlmIChvYmouZGV0YWNoRXZlbnQpIHsKICAgICAgb2JqLmRldGFjaEV2ZW50KGV2ZW50TmFtZSwgZnVuYyk7CiAgICB9CiAgfQoKICAvLyBUcmFuc2xhdGUgYXJyYXkgb2YgdmFsdWVzIHRvIHRvcC9yaWdodC9ib3R0b20vbGVmdCwgYXMgdXN1YWwgd2l0aAogIC8vIHRoZSAicGFkZGluZyIgQ1NTIHByb3BlcnR5CiAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQ1NTL3BhZGRpbmcKICBmdW5jdGlvbiB1bnBhY2tQYWRkaW5nKHZhbHVlKSB7CiAgICBpZiAodHlwZW9mKHZhbHVlKSA9PT0gIm51bWJlciIpCiAgICAgIHZhbHVlID0gW3ZhbHVlXTsKICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDEpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMF0sIGJvdHRvbTogdmFsdWVbMF0sIGxlZnQ6IHZhbHVlWzBdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDIpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMF0sIGxlZnQ6IHZhbHVlWzFdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDMpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMl0sIGxlZnQ6IHZhbHVlWzFdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDQpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMl0sIGxlZnQ6IHZhbHVlWzNdfTsKICAgIH0KICB9CgogIC8vIENvbnZlcnQgYW4gdW5wYWNrZWQgcGFkZGluZyBvYmplY3QgdG8gYSBDU1MgdmFsdWUKICBmdW5jdGlvbiBwYWRkaW5nVG9Dc3MocGFkZGluZ09iaikgewogICAgcmV0dXJuIHBhZGRpbmdPYmoudG9wICsgInB4ICIgKyBwYWRkaW5nT2JqLnJpZ2h0ICsgInB4ICIgKyBwYWRkaW5nT2JqLmJvdHRvbSArICJweCAiICsgcGFkZGluZ09iai5sZWZ0ICsgInB4IjsKICB9CgogIC8vIE1ha2VzIGEgbnVtYmVyIHN1aXRhYmxlIGZvciBDU1MKICBmdW5jdGlvbiBweCh4KSB7CiAgICBpZiAodHlwZW9mKHgpID09PSAibnVtYmVyIikKICAgICAgcmV0dXJuIHggKyAicHgiOwogICAgZWxzZQogICAgICByZXR1cm4geDsKICB9CgogIC8vIFJldHJpZXZlcyBydW50aW1lIHdpZGdldCBzaXppbmcgaW5mb3JtYXRpb24gZm9yIGFuIGVsZW1lbnQuCiAgLy8gVGhlIHJldHVybiB2YWx1ZSBpcyBlaXRoZXIgbnVsbCwgb3IgYW4gb2JqZWN0IHdpdGggZmlsbCwgcGFkZGluZywKICAvLyBkZWZhdWx0V2lkdGgsIGRlZmF1bHRIZWlnaHQgZmllbGRzLgogIGZ1bmN0aW9uIHNpemluZ1BvbGljeShlbCkgewogICAgdmFyIHNpemluZ0VsID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcigic2NyaXB0W2RhdGEtZm9yPSciICsgZWwuaWQgKyAiJ11bdHlwZT0nYXBwbGljYXRpb24vaHRtbHdpZGdldC1zaXppbmcnXSIpOwogICAgaWYgKCFzaXppbmdFbCkKICAgICAgcmV0dXJuIG51bGw7CiAgICB2YXIgc3AgPSBKU09OLnBhcnNlKHNpemluZ0VsLnRleHRDb250ZW50IHx8IHNpemluZ0VsLnRleHQgfHwgInt9Iik7CiAgICBpZiAodmlld2VyTW9kZSkgewogICAgICByZXR1cm4gc3Audmlld2VyOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHNwLmJyb3dzZXI7CiAgICB9CiAgfQoKICAvLyBAcGFyYW0gdGFza3MgQXJyYXkgb2Ygc3RyaW5ncyAob3IgZmFsc3kgdmFsdWUsIGluIHdoaWNoIGNhc2Ugbm8tb3ApLgogIC8vICAgRWFjaCBlbGVtZW50IG11c3QgYmUgYSB2YWxpZCBKYXZhU2NyaXB0IGV4cHJlc3Npb24gdGhhdCB5aWVsZHMgYQogIC8vICAgZnVuY3Rpb24uIE9yLCBjYW4gYmUgYW4gYXJyYXkgb2Ygb2JqZWN0cyB3aXRoICJjb2RlIiBhbmQgImRhdGEiCiAgLy8gICBwcm9wZXJ0aWVzOyBpbiB0aGlzIGNhc2UsIHRoZSAiY29kZSIgcHJvcGVydHkgc2hvdWxkIGJlIGEgc3RyaW5nCiAgLy8gICBvZiBKUyB0aGF0J3MgYW4gZXhwciB0aGF0IHlpZWxkcyBhIGZ1bmN0aW9uLCBhbmQgImRhdGEiIHNob3VsZCBiZQogIC8vICAgYW4gb2JqZWN0IHRoYXQgd2lsbCBiZSBhZGRlZCBhcyBhbiBhZGRpdGlvbmFsIGFyZ3VtZW50IHdoZW4gdGhhdAogIC8vICAgZnVuY3Rpb24gaXMgY2FsbGVkLgogIC8vIEBwYXJhbSB0YXJnZXQgVGhlIG9iamVjdCB0aGF0IHdpbGwgYmUgInRoaXMiIGZvciBlYWNoIGZ1bmN0aW9uCiAgLy8gICBleGVjdXRpb24uCiAgLy8gQHBhcmFtIGFyZ3MgQXJyYXkgb2YgYXJndW1lbnRzIHRvIGJlIHBhc3NlZCB0byB0aGUgZnVuY3Rpb25zLiAoVGhlCiAgLy8gICBzYW1lIGFyZ3VtZW50cyB3aWxsIGJlIHBhc3NlZCB0byBhbGwgZnVuY3Rpb25zLikKICBmdW5jdGlvbiBldmFsQW5kUnVuKHRhc2tzLCB0YXJnZXQsIGFyZ3MpIHsKICAgIGlmICh0YXNrcykgewogICAgICBmb3JFYWNoKHRhc2tzLCBmdW5jdGlvbih0YXNrKSB7CiAgICAgICAgdmFyIHRoZXNlQXJncyA9IGFyZ3M7CiAgICAgICAgaWYgKHR5cGVvZih0YXNrKSA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgIHRoZXNlQXJncyA9IHRoZXNlQXJncy5jb25jYXQoW3Rhc2suZGF0YV0pOwogICAgICAgICAgdGFzayA9IHRhc2suY29kZTsKICAgICAgICB9CiAgICAgICAgdmFyIHRhc2tGdW5jID0gZXZhbCgiKCIgKyB0YXNrICsgIikiKTsKICAgICAgICBpZiAodHlwZW9mKHRhc2tGdW5jKSAhPT0gImZ1bmN0aW9uIikgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUYXNrIG11c3QgYmUgYSBmdW5jdGlvbiEgU291cmNlOlxuIiArIHRhc2spOwogICAgICAgIH0KICAgICAgICB0YXNrRnVuYy5hcHBseSh0YXJnZXQsIHRoZXNlQXJncyk7CiAgICAgIH0pOwogICAgfQogIH0KCiAgZnVuY3Rpb24gaW5pdFNpemluZyhlbCkgewogICAgdmFyIHNpemluZyA9IHNpemluZ1BvbGljeShlbCk7CiAgICBpZiAoIXNpemluZykKICAgICAgcmV0dXJuOwoKICAgIHZhciBjZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaHRtbHdpZGdldF9jb250YWluZXIiKTsKICAgIGlmICghY2VsKQogICAgICByZXR1cm47CgogICAgaWYgKHR5cGVvZihzaXppbmcucGFkZGluZykgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUubWFyZ2luID0gIjAiOwogICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLnBhZGRpbmcgPSBwYWRkaW5nVG9Dc3ModW5wYWNrUGFkZGluZyhzaXppbmcucGFkZGluZykpOwogICAgfQoKICAgIGlmIChzaXppbmcuZmlsbCkgewogICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiI7CiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUud2lkdGggPSAiMTAwJSI7CiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUuaGVpZ2h0ID0gIjEwMCUiOwogICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUud2lkdGggPSAiMTAwJSI7CiAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5oZWlnaHQgPSAiMTAwJSI7CiAgICAgIGlmIChjZWwpIHsKICAgICAgICBjZWwuc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiOwogICAgICAgIHZhciBwYWQgPSB1bnBhY2tQYWRkaW5nKHNpemluZy5wYWRkaW5nKTsKICAgICAgICBjZWwuc3R5bGUudG9wID0gcGFkLnRvcCArICJweCI7CiAgICAgICAgY2VsLnN0eWxlLnJpZ2h0ID0gcGFkLnJpZ2h0ICsgInB4IjsKICAgICAgICBjZWwuc3R5bGUuYm90dG9tID0gcGFkLmJvdHRvbSArICJweCI7CiAgICAgICAgY2VsLnN0eWxlLmxlZnQgPSBwYWQubGVmdCArICJweCI7CiAgICAgICAgZWwuc3R5bGUud2lkdGggPSAiMTAwJSI7CiAgICAgICAgZWwuc3R5bGUuaGVpZ2h0ID0gIjEwMCUiOwogICAgICB9CgogICAgICByZXR1cm4gewogICAgICAgIGdldFdpZHRoOiBmdW5jdGlvbigpIHsgcmV0dXJuIGNlbC5vZmZzZXRXaWR0aDsgfSwKICAgICAgICBnZXRIZWlnaHQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gY2VsLm9mZnNldEhlaWdodDsgfQogICAgICB9OwoKICAgIH0gZWxzZSB7CiAgICAgIGVsLnN0eWxlLndpZHRoID0gcHgoc2l6aW5nLndpZHRoKTsKICAgICAgZWwuc3R5bGUuaGVpZ2h0ID0gcHgoc2l6aW5nLmhlaWdodCk7CgogICAgICByZXR1cm4gewogICAgICAgIGdldFdpZHRoOiBmdW5jdGlvbigpIHsgcmV0dXJuIGVsLm9mZnNldFdpZHRoOyB9LAogICAgICAgIGdldEhlaWdodDogZnVuY3Rpb24oKSB7IHJldHVybiBlbC5vZmZzZXRIZWlnaHQ7IH0KICAgICAgfTsKICAgIH0KICB9CgogIC8vIERlZmF1bHQgaW1wbGVtZW50YXRpb25zIGZvciBtZXRob2RzCiAgdmFyIGRlZmF1bHRzID0gewogICAgZmluZDogZnVuY3Rpb24oc2NvcGUpIHsKICAgICAgcmV0dXJuIHF1ZXJ5U2VsZWN0b3JBbGwoc2NvcGUsICIuIiArIHRoaXMubmFtZSk7CiAgICB9LAogICAgcmVuZGVyRXJyb3I6IGZ1bmN0aW9uKGVsLCBlcnIpIHsKICAgICAgdmFyICRlbCA9ICQoZWwpOwoKICAgICAgdGhpcy5jbGVhckVycm9yKGVsKTsKCiAgICAgIC8vIEFkZCBhbGwgdGhlc2UgZXJyb3IgY2xhc3NlcywgYXMgU2hpbnkgZG9lcwogICAgICB2YXIgZXJyQ2xhc3MgPSAic2hpbnktb3V0cHV0LWVycm9yIjsKICAgICAgaWYgKGVyci50eXBlICE9PSBudWxsKSB7CiAgICAgICAgLy8gdXNlIHRoZSBjbGFzc2VzIG9mIHRoZSBlcnJvciBjb25kaXRpb24gYXMgQ1NTIGNsYXNzIG5hbWVzCiAgICAgICAgZXJyQ2xhc3MgPSBlcnJDbGFzcyArICIgIiArICQubWFwKGFzQXJyYXkoZXJyLnR5cGUpLCBmdW5jdGlvbih0eXBlKSB7CiAgICAgICAgICByZXR1cm4gZXJyQ2xhc3MgKyAiLSIgKyB0eXBlOwogICAgICAgIH0pLmpvaW4oIiAiKTsKICAgICAgfQogICAgICBlcnJDbGFzcyA9IGVyckNsYXNzICsgIiBodG1sd2lkZ2V0cy1lcnJvciI7CgogICAgICAvLyBJcyBlbCBpbmxpbmUgb3IgYmxvY2s/IElmIGlubGluZSBvciBpbmxpbmUtYmxvY2ssIGp1c3QgZGlzcGxheTpub25lIGl0CiAgICAgIC8vIGFuZCBhZGQgYW4gaW5saW5lIGVycm9yLgogICAgICB2YXIgZGlzcGxheSA9ICRlbC5jc3MoImRpc3BsYXkiKTsKICAgICAgJGVsLmRhdGEoInJlc3RvcmUtZGlzcGxheS1tb2RlIiwgZGlzcGxheSk7CgogICAgICBpZiAoZGlzcGxheSA9PT0gImlubGluZSIgfHwgZGlzcGxheSA9PT0gImlubGluZS1ibG9jayIpIHsKICAgICAgICAkZWwuaGlkZSgpOwogICAgICAgIGlmIChlcnIubWVzc2FnZSAhPT0gIiIpIHsKICAgICAgICAgIHZhciBlcnJvclNwYW4gPSAkKCI8c3Bhbj4iKS5hZGRDbGFzcyhlcnJDbGFzcyk7CiAgICAgICAgICBlcnJvclNwYW4udGV4dChlcnIubWVzc2FnZSk7CiAgICAgICAgICAkZWwuYWZ0ZXIoZXJyb3JTcGFuKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoZGlzcGxheSA9PT0gImJsb2NrIikgewogICAgICAgIC8vIElmIGJsb2NrLCBhZGQgYW4gZXJyb3IganVzdCBhZnRlciB0aGUgZWwsIHNldCB2aXNpYmlsaXR5Om5vbmUgb24gdGhlCiAgICAgICAgLy8gZWwsIGFuZCBwb3NpdGlvbiB0aGUgZXJyb3IgdG8gYmUgb24gdG9wIG9mIHRoZSBlbC4KICAgICAgICAvLyBNYXJrIGl0IHdpdGggYSB1bmlxdWUgSUQgYW5kIENTUyBjbGFzcyBzbyB3ZSBjYW4gcmVtb3ZlIGl0IGxhdGVyLgogICAgICAgICRlbC5jc3MoInZpc2liaWxpdHkiLCAiaGlkZGVuIik7CiAgICAgICAgaWYgKGVyci5tZXNzYWdlICE9PSAiIikgewogICAgICAgICAgdmFyIGVycm9yRGl2ID0gJCgiPGRpdj4iKS5hZGRDbGFzcyhlcnJDbGFzcykuY3NzKCJwb3NpdGlvbiIsICJhYnNvbHV0ZSIpCiAgICAgICAgICAgIC5jc3MoInRvcCIsIGVsLm9mZnNldFRvcCkKICAgICAgICAgICAgLmNzcygibGVmdCIsIGVsLm9mZnNldExlZnQpCiAgICAgICAgICAgIC8vIHNldHRpbmcgd2lkdGggY2FuIHB1c2ggb3V0IHRoZSBwYWdlIHNpemUsIGZvcmNpbmcgb3RoZXJ3aXNlCiAgICAgICAgICAgIC8vIHVubmVjZXNzYXJ5IHNjcm9sbGJhcnMgdG8gYXBwZWFyIGFuZCBtYWtpbmcgaXQgaW1wb3NzaWJsZSBmb3IKICAgICAgICAgICAgLy8gdGhlIGVsZW1lbnQgdG8gc2hyaW5rOyBzbyB1c2UgbWF4LXdpZHRoIGluc3RlYWQKICAgICAgICAgICAgLmNzcygibWF4V2lkdGgiLCBlbC5vZmZzZXRXaWR0aCkKICAgICAgICAgICAgLmNzcygiaGVpZ2h0IiwgZWwub2Zmc2V0SGVpZ2h0KTsKICAgICAgICAgIGVycm9yRGl2LnRleHQoZXJyLm1lc3NhZ2UpOwogICAgICAgICAgJGVsLmFmdGVyKGVycm9yRGl2KTsKCiAgICAgICAgICAvLyBSZWFsbHkgZHVtYiB3YXkgdG8ga2VlcCB0aGUgc2l6ZS9wb3NpdGlvbiBvZiB0aGUgZXJyb3IgaW4gc3luYyB3aXRoCiAgICAgICAgICAvLyB0aGUgcGFyZW50IGVsZW1lbnQgYXMgdGhlIHdpbmRvdyBpcyByZXNpemVkIG9yIHdoYXRldmVyLgogICAgICAgICAgdmFyIGludElkID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmICghZXJyb3JEaXZbMF0ucGFyZW50RWxlbWVudCkgewogICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50SWQpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBlcnJvckRpdgogICAgICAgICAgICAgIC5jc3MoInRvcCIsIGVsLm9mZnNldFRvcCkKICAgICAgICAgICAgICAuY3NzKCJsZWZ0IiwgZWwub2Zmc2V0TGVmdCkKICAgICAgICAgICAgICAuY3NzKCJtYXhXaWR0aCIsIGVsLm9mZnNldFdpZHRoKQogICAgICAgICAgICAgIC5jc3MoImhlaWdodCIsIGVsLm9mZnNldEhlaWdodCk7CiAgICAgICAgICB9LCA1MDApOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGNsZWFyRXJyb3I6IGZ1bmN0aW9uKGVsKSB7CiAgICAgIHZhciAkZWwgPSAkKGVsKTsKICAgICAgdmFyIGRpc3BsYXkgPSAkZWwuZGF0YSgicmVzdG9yZS1kaXNwbGF5LW1vZGUiKTsKICAgICAgJGVsLmRhdGEoInJlc3RvcmUtZGlzcGxheS1tb2RlIiwgbnVsbCk7CgogICAgICBpZiAoZGlzcGxheSA9PT0gImlubGluZSIgfHwgZGlzcGxheSA9PT0gImlubGluZS1ibG9jayIpIHsKICAgICAgICBpZiAoZGlzcGxheSkKICAgICAgICAgICRlbC5jc3MoImRpc3BsYXkiLCBkaXNwbGF5KTsKICAgICAgICAkKGVsLm5leHRTaWJsaW5nKS5maWx0ZXIoIi5odG1sd2lkZ2V0cy1lcnJvciIpLnJlbW92ZSgpOwogICAgICB9IGVsc2UgaWYgKGRpc3BsYXkgPT09ICJibG9jayIpewogICAgICAgICRlbC5jc3MoInZpc2liaWxpdHkiLCAiaW5oZXJpdCIpOwogICAgICAgICQoZWwubmV4dFNpYmxpbmcpLmZpbHRlcigiLmh0bWx3aWRnZXRzLWVycm9yIikucmVtb3ZlKCk7CiAgICAgIH0KICAgIH0sCiAgICBzaXppbmc6IHt9CiAgfTsKCiAgLy8gQ2FsbGVkIGJ5IHdpZGdldCBiaW5kaW5ncyB0byByZWdpc3RlciBhIG5ldyB0eXBlIG9mIHdpZGdldC4gVGhlIGRlZmluaXRpb24KICAvLyBvYmplY3QgY2FuIGNvbnRhaW4gdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOgogIC8vIC0gbmFtZSAocmVxdWlyZWQpIC0gQSBzdHJpbmcgaW5kaWNhdGluZyB0aGUgYmluZGluZyBuYW1lLCB3aGljaCB3aWxsIGJlCiAgLy8gICB1c2VkIGJ5IGRlZmF1bHQgYXMgdGhlIENTUyBjbGFzc25hbWUgdG8gbG9vayBmb3IuCiAgLy8gLSBpbml0aWFsaXplIChvcHRpb25hbCkgLSBBIGZ1bmN0aW9uKGVsKSB0aGF0IHdpbGwgYmUgY2FsbGVkIG9uY2UgcGVyCiAgLy8gICB3aWRnZXQgZWxlbWVudDsgaWYgYSB2YWx1ZSBpcyByZXR1cm5lZCwgaXQgd2lsbCBiZSBwYXNzZWQgYXMgdGhlIHRoaXJkCiAgLy8gICB2YWx1ZSB0byByZW5kZXJWYWx1ZS4KICAvLyAtIHJlbmRlclZhbHVlIChyZXF1aXJlZCkgLSBBIGZ1bmN0aW9uKGVsLCBkYXRhLCBpbml0VmFsdWUpIHRoYXQgd2lsbCBiZQogIC8vICAgY2FsbGVkIHdpdGggZGF0YS4gU3RhdGljIGNvbnRleHRzIHdpbGwgY2F1c2UgdGhpcyB0byBiZSBjYWxsZWQgb25jZSBwZXIKICAvLyAgIGVsZW1lbnQ7IFNoaW55IGFwcHMgd2lsbCBjYXVzZSB0aGlzIHRvIGJlIGNhbGxlZCBtdWx0aXBsZSB0aW1lcyBwZXIKICAvLyAgIGVsZW1lbnQsIGFzIHRoZSBkYXRhIGNoYW5nZXMuCiAgd2luZG93LkhUTUxXaWRnZXRzLndpZGdldCA9IGZ1bmN0aW9uKGRlZmluaXRpb24pIHsKICAgIGlmICghZGVmaW5pdGlvbi5uYW1lKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiV2lkZ2V0IG11c3QgaGF2ZSBhIG5hbWUiKTsKICAgIH0KICAgIGlmICghZGVmaW5pdGlvbi50eXBlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiV2lkZ2V0IG11c3QgaGF2ZSBhIHR5cGUiKTsKICAgIH0KICAgIC8vIEN1cnJlbnRseSB3ZSBvbmx5IHN1cHBvcnQgb3V0cHV0IHdpZGdldHMKICAgIGlmIChkZWZpbml0aW9uLnR5cGUgIT09ICJvdXRwdXQiKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiVW5yZWNvZ25pemVkIHdpZGdldCB0eXBlICciICsgZGVmaW5pdGlvbi50eXBlICsgIiciKTsKICAgIH0KICAgIC8vIFRPRE86IFZlcmlmeSB0aGF0IC5uYW1lIGlzIGEgdmFsaWQgQ1NTIGNsYXNzbmFtZQoKICAgIC8vIFN1cHBvcnQgbmV3LXN0eWxlIGluc3RhbmNlLWJvdW5kIGRlZmluaXRpb25zLiBPbGQtc3R5bGUgY2xhc3MtYm91bmQKICAgIC8vIGRlZmluaXRpb25zIGhhdmUgb25lIHdpZGdldCAib2JqZWN0IiBwZXIgd2lkZ2V0IHBlciB0eXBlL2NsYXNzIG9mCiAgICAvLyB3aWRnZXQ7IHRoZSByZW5kZXJWYWx1ZSBhbmQgcmVzaXplIG1ldGhvZHMgb24gc3VjaCB3aWRnZXQgb2JqZWN0cwogICAgLy8gdGFrZSBlbCBhbmQgaW5zdGFuY2UgYXJndW1lbnRzLCBiZWNhdXNlIHRoZSB3aWRnZXQgb2JqZWN0IGNhbid0CiAgICAvLyBzdG9yZSB0aGVtLiBOZXctc3R5bGUgaW5zdGFuY2UtYm91bmQgZGVmaW5pdGlvbnMgaGF2ZSBvbmUgd2lkZ2V0CiAgICAvLyBvYmplY3QgcGVyIHdpZGdldCBpbnN0YW5jZTsgdGhlIGRlZmluaXRpb24gdGhhdCdzIHBhc3NlZCBpbiBkb2Vzbid0CiAgICAvLyBwcm92aWRlIHJlbmRlclZhbHVlIG9yIHJlc2l6ZSBtZXRob2RzIGF0IGFsbCwganVzdCB0aGUgc2luZ2xlIG1ldGhvZAogICAgLy8gICBmYWN0b3J5KGVsLCB3aWR0aCwgaGVpZ2h0KQogICAgLy8gd2hpY2ggcmV0dXJucyBhbiBvYmplY3QgdGhhdCBoYXMgcmVuZGVyVmFsdWUoeCkgYW5kIHJlc2l6ZSh3LCBoKS4KICAgIC8vIFRoaXMgZW5hYmxlcyBhIGZhciBtb3JlIG5hdHVyYWwgcHJvZ3JhbW1pbmcgc3R5bGUgZm9yIHRoZSB3aWRnZXQKICAgIC8vIGF1dGhvciwgd2hvIGNhbiBzdG9yZSBwZXItaW5zdGFuY2Ugc3RhdGUgdXNpbmcgZWl0aGVyIE9PLXN0eWxlCiAgICAvLyBpbnN0YW5jZSBmaWVsZHMgb3IgZnVuY3Rpb25hbC1zdHlsZSBjbG9zdXJlIHZhcmlhYmxlcyAoSSBndWVzcyB0aGlzCiAgICAvLyBpcyBpbiBjb250cmFzdCB0byB3aGF0IGNhbiBvbmx5IGJlIGNhbGxlZCBDLXN0eWxlIHBzZXVkby1PTyB3aGljaCBpcwogICAgLy8gd2hhdCB3ZSByZXF1aXJlZCBiZWZvcmUpLgogICAgaWYgKGRlZmluaXRpb24uZmFjdG9yeSkgewogICAgICBkZWZpbml0aW9uID0gY3JlYXRlTGVnYWN5RGVmaW5pdGlvbkFkYXB0ZXIoZGVmaW5pdGlvbik7CiAgICB9CgogICAgaWYgKCFkZWZpbml0aW9uLnJlbmRlclZhbHVlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiV2lkZ2V0IG11c3QgaGF2ZSBhIHJlbmRlclZhbHVlIGZ1bmN0aW9uIik7CiAgICB9CgogICAgLy8gRm9yIHN0YXRpYyByZW5kZXJpbmcgKG5vbi1TaGlueSksIHVzZSBhIHNpbXBsZSB3aWRnZXQgcmVnaXN0cmF0aW9uCiAgICAvLyBzY2hlbWUuIFdlIGFsc28gdXNlIHRoaXMgc2NoZW1lIGZvciBTaGlueSBhcHBzL2RvY3VtZW50cyB0aGF0IGFsc28KICAgIC8vIGNvbnRhaW4gc3RhdGljIHdpZGdldHMuCiAgICB3aW5kb3cuSFRNTFdpZGdldHMud2lkZ2V0cyA9IHdpbmRvdy5IVE1MV2lkZ2V0cy53aWRnZXRzIHx8IFtdOwogICAgLy8gTWVyZ2UgZGVmYXVsdHMgaW50byB0aGUgZGVmaW5pdGlvbjsgZG9uJ3QgbXV0YXRlIHRoZSBvcmlnaW5hbCBkZWZpbml0aW9uLgogICAgdmFyIHN0YXRpY0JpbmRpbmcgPSBleHRlbmQoe30sIGRlZmF1bHRzLCBkZWZpbml0aW9uKTsKICAgIG92ZXJyaWRlTWV0aG9kKHN0YXRpY0JpbmRpbmcsICJmaW5kIiwgZnVuY3Rpb24oc3VwZXJmdW5jKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbihzY29wZSkgewogICAgICAgIHZhciByZXN1bHRzID0gc3VwZXJmdW5jKHNjb3BlKTsKICAgICAgICAvLyBGaWx0ZXIgb3V0IFNoaW55IG91dHB1dHMsIHdlIG9ubHkgd2FudCB0aGUgc3RhdGljIGtpbmQKICAgICAgICByZXR1cm4gZmlsdGVyQnlDbGFzcyhyZXN1bHRzLCAiaHRtbC13aWRnZXQtb3V0cHV0IiwgZmFsc2UpOwogICAgICB9OwogICAgfSk7CiAgICB3aW5kb3cuSFRNTFdpZGdldHMud2lkZ2V0cy5wdXNoKHN0YXRpY0JpbmRpbmcpOwoKICAgIGlmIChzaGlueU1vZGUpIHsKICAgICAgLy8gU2hpbnkgaXMgcnVubmluZy4gUmVnaXN0ZXIgdGhlIGRlZmluaXRpb24gd2l0aCBhbiBvdXRwdXQgYmluZGluZy4KICAgICAgLy8gVGhlIGRlZmluaXRpb24gaXRzZWxmIHdpbGwgbm90IGJlIHRoZSBvdXRwdXQgYmluZGluZywgaW5zdGVhZAogICAgICAvLyB3ZSB3aWxsIG1ha2UgYW4gb3V0cHV0IGJpbmRpbmcgb2JqZWN0IHRoYXQgZGVsZWdhdGVzIHRvIHRoZQogICAgICAvLyBkZWZpbml0aW9uLiBUaGlzIGlzIGJlY2F1c2Ugd2UgZm9vbGlzaGx5IHVzZWQgdGhlIHNhbWUgbWV0aG9kCiAgICAgIC8vIG5hbWUgKHJlbmRlclZhbHVlKSBmb3IgaHRtbHdpZGdldHMgZGVmaW5pdGlvbiBhbmQgU2hpbnkgYmluZGluZ3MKICAgICAgLy8gYnV0IHRoZXkgYWN0dWFsbHkgaGF2ZSBxdWl0ZSBkaWZmZXJlbnQgc2VtYW50aWNzICh0aGUgU2hpbnkKICAgICAgLy8gYmluZGluZ3MgcmVjZWl2ZSBkYXRhIHRoYXQgaW5jbHVkZXMgbG90cyBvZiBtZXRhZGF0YSB0aGF0IGl0CiAgICAgIC8vIHN0cmlwcyBvZmYgYmVmb3JlIGNhbGxpbmcgaHRtbHdpZGdldHMgcmVuZGVyVmFsdWUpLiBXZSBjYW4ndAogICAgICAvLyBqdXN0IGlnbm9yZSB0aGUgZGlmZmVyZW5jZSBiZWNhdXNlIGluIHNvbWUgd2lkZ2V0cyBpdCdzIGhlbHBmdWwKICAgICAgLy8gdG8gY2FsbCB0aGlzLnJlbmRlclZhbHVlKCkgZnJvbSBpbnNpZGUgb2YgcmVzaXplKCksIGFuZCBpZgogICAgICAvLyB3ZSdyZSBub3QgZGVsZWdhdGluZywgdGhlbiB0aGF0IGNhbGwgd2lsbCBnbyB0byB0aGUgU2hpbnkKICAgICAgLy8gdmVyc2lvbiBpbnN0ZWFkIG9mIHRoZSBodG1sd2lkZ2V0cyB2ZXJzaW9uLgoKICAgICAgLy8gTWVyZ2UgZGVmYXVsdHMgd2l0aCBkZWZpbml0aW9uLCB3aXRob3V0IG11dGF0aW5nIGVpdGhlci4KICAgICAgdmFyIGJpbmRpbmdEZWYgPSBleHRlbmQoe30sIGRlZmF1bHRzLCBkZWZpbml0aW9uKTsKCiAgICAgIC8vIFRoaXMgb2JqZWN0IHdpbGwgYmUgb3VyIGFjdHVhbCBTaGlueSBiaW5kaW5nLgogICAgICB2YXIgc2hpbnlCaW5kaW5nID0gbmV3IFNoaW55Lk91dHB1dEJpbmRpbmcoKTsKCiAgICAgIC8vIFdpdGggYSBmZXcgZXhjZXB0aW9ucywgd2UnbGwgd2FudCB0byBzaW1wbHkgdXNlIHRoZSBiaW5kaW5nRGVmJ3MKICAgICAgLy8gdmVyc2lvbiBvZiBtZXRob2RzIGlmIHRoZXkgYXJlIGF2YWlsYWJsZSwgb3RoZXJ3aXNlIGZhbGwgYmFjayB0bwogICAgICAvLyBTaGlueSdzIGRlZmF1bHRzLiBOT1RFOiBJZiBTaGlueSdzIG91dHB1dCBiaW5kaW5ncyBnYWluIGFkZGl0aW9uYWwKICAgICAgLy8gbWV0aG9kcyBpbiB0aGUgZnV0dXJlLCBhbmQgd2Ugd2FudCB0aGVtIHRvIGJlIG92ZXJyaWRlYWJsZSBieQogICAgICAvLyBIVE1MV2lkZ2V0IGJpbmRpbmcgZGVmaW5pdGlvbnMsIHRoZW4gd2UnbGwgbmVlZCB0byBhZGQgdGhlbSB0byB0aGlzCiAgICAgIC8vIGxpc3QuCiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgImdldElkIik7CiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgIm9uVmFsdWVDaGFuZ2UiKTsKICAgICAgZGVsZWdhdGVNZXRob2Qoc2hpbnlCaW5kaW5nLCBiaW5kaW5nRGVmLCAib25WYWx1ZUVycm9yIik7CiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgInJlbmRlckVycm9yIik7CiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgImNsZWFyRXJyb3IiKTsKICAgICAgZGVsZWdhdGVNZXRob2Qoc2hpbnlCaW5kaW5nLCBiaW5kaW5nRGVmLCAic2hvd1Byb2dyZXNzIik7CgogICAgICAvLyBUaGUgZmluZCwgcmVuZGVyVmFsdWUsIGFuZCByZXNpemUgYXJlIGhhbmRsZWQgZGlmZmVyZW50bHksIGJlY2F1c2Ugd2UKICAgICAgLy8gd2FudCB0byBhY3R1YWxseSBkZWNvcmF0ZSB0aGUgYmVoYXZpb3Igb2YgdGhlIGJpbmRpbmdEZWYgbWV0aG9kcy4KCiAgICAgIHNoaW55QmluZGluZy5maW5kID0gZnVuY3Rpb24oc2NvcGUpIHsKICAgICAgICB2YXIgcmVzdWx0cyA9IGJpbmRpbmdEZWYuZmluZChzY29wZSk7CgogICAgICAgIC8vIE9ubHkgcmV0dXJuIGVsZW1lbnRzIHRoYXQgYXJlIFNoaW55IG91dHB1dHMsIG5vdCBzdGF0aWMgb25lcwogICAgICAgIHZhciBkeW5hbWljUmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKCIuaHRtbC13aWRnZXQtb3V0cHV0Iik7CgogICAgICAgIC8vIEl0J3MgcG9zc2libGUgdGhhdCB3aGF0ZXZlciBjYXVzZWQgU2hpbnkgdG8gdGhpbmsgdGhlcmUgbWlnaHQgYmUKICAgICAgICAvLyBuZXcgZHluYW1pYyBvdXRwdXRzLCBhbHNvIGNhdXNlZCB0aGVyZSB0byBiZSBuZXcgc3RhdGljIG91dHB1dHMuCiAgICAgICAgLy8gU2luY2UgdGhlcmUgbWlnaHQgYmUgbG90cyBvZiBkaWZmZXJlbnQgaHRtbHdpZGdldHMgYmluZGluZ3MsIHdlCiAgICAgICAgLy8gc2NoZWR1bGUgZXhlY3V0aW9uIGZvciBsYXRlci0tbm8gbmVlZCB0byBzdGF0aWNSZW5kZXIgbXVsdGlwbGUKICAgICAgICAvLyB0aW1lcy4KICAgICAgICBpZiAocmVzdWx0cy5sZW5ndGggIT09IGR5bmFtaWNSZXN1bHRzLmxlbmd0aCkKICAgICAgICAgIHNjaGVkdWxlU3RhdGljUmVuZGVyKCk7CgogICAgICAgIHJldHVybiBkeW5hbWljUmVzdWx0czsKICAgICAgfTsKCiAgICAgIC8vIFdyYXAgcmVuZGVyVmFsdWUgdG8gaGFuZGxlIGluaXRpYWxpemF0aW9uLCB3aGljaCB1bmZvcnR1bmF0ZWx5IGlzbid0CiAgICAgIC8vIHN1cHBvcnRlZCBuYXRpdmVseSBieSBTaGlueSBhdCB0aGUgdGltZSBvZiB0aGlzIHdyaXRpbmcuCgogICAgICBzaGlueUJpbmRpbmcucmVuZGVyVmFsdWUgPSBmdW5jdGlvbihlbCwgZGF0YSkgewogICAgICAgIFNoaW55LnJlbmRlckRlcGVuZGVuY2llcyhkYXRhLmRlcHMpOwogICAgICAgIC8vIFJlc29sdmUgc3RyaW5ncyBtYXJrZWQgYXMgamF2YXNjcmlwdCBsaXRlcmFscyB0byBvYmplY3RzCiAgICAgICAgaWYgKCEoZGF0YS5ldmFscyBpbnN0YW5jZW9mIEFycmF5KSkgZGF0YS5ldmFscyA9IFtkYXRhLmV2YWxzXTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgZGF0YS5ldmFscyAmJiBpIDwgZGF0YS5ldmFscy5sZW5ndGg7IGkrKykgewogICAgICAgICAgd2luZG93LkhUTUxXaWRnZXRzLmV2YWx1YXRlU3RyaW5nTWVtYmVyKGRhdGEueCwgZGF0YS5ldmFsc1tpXSk7CiAgICAgICAgfQogICAgICAgIGlmICghYmluZGluZ0RlZi5yZW5kZXJPbk51bGxWYWx1ZSkgewogICAgICAgICAgaWYgKGRhdGEueCA9PT0gbnVsbCkgewogICAgICAgICAgICBlbC5zdHlsZS52aXNpYmlsaXR5ID0gImhpZGRlbiI7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVsLnN0eWxlLnZpc2liaWxpdHkgPSAiaW5oZXJpdCI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghZWxlbWVudERhdGEoZWwsICJpbml0aWFsaXplZCIpKSB7CiAgICAgICAgICBpbml0U2l6aW5nKGVsKTsKCiAgICAgICAgICBlbGVtZW50RGF0YShlbCwgImluaXRpYWxpemVkIiwgdHJ1ZSk7CiAgICAgICAgICBpZiAoYmluZGluZ0RlZi5pbml0aWFsaXplKSB7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBiaW5kaW5nRGVmLmluaXRpYWxpemUoZWwsIGVsLm9mZnNldFdpZHRoLAogICAgICAgICAgICAgIGVsLm9mZnNldEhlaWdodCk7CiAgICAgICAgICAgIGVsZW1lbnREYXRhKGVsLCAiaW5pdF9yZXN1bHQiLCByZXN1bHQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBiaW5kaW5nRGVmLnJlbmRlclZhbHVlKGVsLCBkYXRhLngsIGVsZW1lbnREYXRhKGVsLCAiaW5pdF9yZXN1bHQiKSk7CiAgICAgICAgZXZhbEFuZFJ1bihkYXRhLmpzSG9va3MucmVuZGVyLCBlbGVtZW50RGF0YShlbCwgImluaXRfcmVzdWx0IiksIFtlbCwgZGF0YS54XSk7CiAgICAgIH07CgogICAgICAvLyBPbmx5IG92ZXJyaWRlIHJlc2l6ZSBpZiBiaW5kaW5nRGVmIGltcGxlbWVudHMgaXQKICAgICAgaWYgKGJpbmRpbmdEZWYucmVzaXplKSB7CiAgICAgICAgc2hpbnlCaW5kaW5nLnJlc2l6ZSA9IGZ1bmN0aW9uKGVsLCB3aWR0aCwgaGVpZ2h0KSB7CiAgICAgICAgICAvLyBTaGlueSBjYW4gY2FsbCByZXNpemUgYmVmb3JlIGluaXRpYWxpemUvcmVuZGVyVmFsdWUgaGF2ZSBiZWVuCiAgICAgICAgICAvLyBjYWxsZWQsIHdoaWNoIGRvZXNuJ3QgbWFrZSBzZW5zZSBmb3Igd2lkZ2V0cy4KICAgICAgICAgIGlmIChlbGVtZW50RGF0YShlbCwgImluaXRpYWxpemVkIikpIHsKICAgICAgICAgICAgYmluZGluZ0RlZi5yZXNpemUoZWwsIHdpZHRoLCBoZWlnaHQsIGVsZW1lbnREYXRhKGVsLCAiaW5pdF9yZXN1bHQiKSk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfQoKICAgICAgU2hpbnkub3V0cHV0QmluZGluZ3MucmVnaXN0ZXIoc2hpbnlCaW5kaW5nLCBiaW5kaW5nRGVmLm5hbWUpOwogICAgfQogIH07CgogIHZhciBzY2hlZHVsZVN0YXRpY1JlbmRlclRpbWVySWQgPSBudWxsOwogIGZ1bmN0aW9uIHNjaGVkdWxlU3RhdGljUmVuZGVyKCkgewogICAgaWYgKCFzY2hlZHVsZVN0YXRpY1JlbmRlclRpbWVySWQpIHsKICAgICAgc2NoZWR1bGVTdGF0aWNSZW5kZXJUaW1lcklkID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICBzY2hlZHVsZVN0YXRpY1JlbmRlclRpbWVySWQgPSBudWxsOwogICAgICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTsKICAgICAgfSwgMSk7CiAgICB9CiAgfQoKICAvLyBSZW5kZXIgc3RhdGljIHdpZGdldHMgYWZ0ZXIgdGhlIGRvY3VtZW50IGZpbmlzaGVzIGxvYWRpbmcKICAvLyBTdGF0aWNhbGx5IHJlbmRlciBhbGwgZWxlbWVudHMgdGhhdCBhcmUgb2YgdGhpcyB3aWRnZXQncyBjbGFzcwogIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIgPSBmdW5jdGlvbigpIHsKICAgIHZhciBiaW5kaW5ncyA9IHdpbmRvdy5IVE1MV2lkZ2V0cy53aWRnZXRzIHx8IFtdOwogICAgZm9yRWFjaChiaW5kaW5ncywgZnVuY3Rpb24oYmluZGluZykgewogICAgICB2YXIgbWF0Y2hlcyA9IGJpbmRpbmcuZmluZChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpOwogICAgICBmb3JFYWNoKG1hdGNoZXMsIGZ1bmN0aW9uKGVsKSB7CiAgICAgICAgdmFyIHNpemVPYmogPSBpbml0U2l6aW5nKGVsLCBiaW5kaW5nKTsKCiAgICAgICAgaWYgKGhhc0NsYXNzKGVsLCAiaHRtbC13aWRnZXQtc3RhdGljLWJvdW5kIikpCiAgICAgICAgICByZXR1cm47CiAgICAgICAgZWwuY2xhc3NOYW1lID0gZWwuY2xhc3NOYW1lICsgIiBodG1sLXdpZGdldC1zdGF0aWMtYm91bmQiOwoKICAgICAgICB2YXIgaW5pdFJlc3VsdDsKICAgICAgICBpZiAoYmluZGluZy5pbml0aWFsaXplKSB7CiAgICAgICAgICBpbml0UmVzdWx0ID0gYmluZGluZy5pbml0aWFsaXplKGVsLAogICAgICAgICAgICBzaXplT2JqID8gc2l6ZU9iai5nZXRXaWR0aCgpIDogZWwub2Zmc2V0V2lkdGgsCiAgICAgICAgICAgIHNpemVPYmogPyBzaXplT2JqLmdldEhlaWdodCgpIDogZWwub2Zmc2V0SGVpZ2h0CiAgICAgICAgICApOwogICAgICAgICAgZWxlbWVudERhdGEoZWwsICJpbml0X3Jlc3VsdCIsIGluaXRSZXN1bHQpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGJpbmRpbmcucmVzaXplKSB7CiAgICAgICAgICB2YXIgbGFzdFNpemUgPSB7CiAgICAgICAgICAgIHc6IHNpemVPYmogPyBzaXplT2JqLmdldFdpZHRoKCkgOiBlbC5vZmZzZXRXaWR0aCwKICAgICAgICAgICAgaDogc2l6ZU9iaiA/IHNpemVPYmouZ2V0SGVpZ2h0KCkgOiBlbC5vZmZzZXRIZWlnaHQKICAgICAgICAgIH07CiAgICAgICAgICB2YXIgcmVzaXplSGFuZGxlciA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgdmFyIHNpemUgPSB7CiAgICAgICAgICAgICAgdzogc2l6ZU9iaiA/IHNpemVPYmouZ2V0V2lkdGgoKSA6IGVsLm9mZnNldFdpZHRoLAogICAgICAgICAgICAgIGg6IHNpemVPYmogPyBzaXplT2JqLmdldEhlaWdodCgpIDogZWwub2Zmc2V0SGVpZ2h0CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmIChzaXplLncgPT09IDAgJiYgc2l6ZS5oID09PSAwKQogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgaWYgKHNpemUudyA9PT0gbGFzdFNpemUudyAmJiBzaXplLmggPT09IGxhc3RTaXplLmgpCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBsYXN0U2l6ZSA9IHNpemU7CiAgICAgICAgICAgIGJpbmRpbmcucmVzaXplKGVsLCBzaXplLncsIHNpemUuaCwgaW5pdFJlc3VsdCk7CiAgICAgICAgICB9OwoKICAgICAgICAgIG9uKHdpbmRvdywgInJlc2l6ZSIsIHJlc2l6ZUhhbmRsZXIpOwoKICAgICAgICAgIC8vIFRoaXMgaXMgbmVlZGVkIGZvciBjYXNlcyB3aGVyZSB3ZSdyZSBydW5uaW5nIGluIGEgU2hpbnkKICAgICAgICAgIC8vIGFwcCwgYnV0IHRoZSB3aWRnZXQgaXRzZWxmIGlzIG5vdCBhIFNoaW55IG91dHB1dCwgYnV0CiAgICAgICAgICAvLyByYXRoZXIgYSBzaW1wbGUgc3RhdGljIHdpZGdldC4gT25lIGV4YW1wbGUgb2YgdGhpcyBpcwogICAgICAgICAgLy8gYW4gcm1hcmtkb3duIGRvY3VtZW50IHRoYXQgaGFzIHJ1bnRpbWU6c2hpbnkgYW5kIHdpZGdldAogICAgICAgICAgLy8gdGhhdCBpc24ndCBpbiBhIHJlbmRlciBmdW5jdGlvbi4gU2hpbnkgb25seSBrbm93cyB0bwogICAgICAgICAgLy8gY2FsbCByZXNpemUgaGFuZGxlcnMgZm9yIFNoaW55IG91dHB1dHMsIG5vdCBmb3Igc3RhdGljCiAgICAgICAgICAvLyB3aWRnZXRzLCBzbyB3ZSBkbyBpdCBvdXJzZWx2ZXMuCiAgICAgICAgICBpZiAod2luZG93LmpRdWVyeSkgewogICAgICAgICAgICB3aW5kb3cualF1ZXJ5KGRvY3VtZW50KS5vbigKICAgICAgICAgICAgICAic2hvd24uaHRtbHdpZGdldHMgc2hvd24uYnMudGFiLmh0bWx3aWRnZXRzIHNob3duLmJzLmNvbGxhcHNlLmh0bWx3aWRnZXRzIiwKICAgICAgICAgICAgICByZXNpemVIYW5kbGVyCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHdpbmRvdy5qUXVlcnkoZG9jdW1lbnQpLm9uKAogICAgICAgICAgICAgICJoaWRkZW4uaHRtbHdpZGdldHMgaGlkZGVuLmJzLnRhYi5odG1sd2lkZ2V0cyBoaWRkZW4uYnMuY29sbGFwc2UuaHRtbHdpZGdldHMiLAogICAgICAgICAgICAgIHJlc2l6ZUhhbmRsZXIKICAgICAgICAgICAgKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBUaGlzIGlzIG5lZWRlZCBmb3IgdGhlIHNwZWNpZmljIGNhc2Ugb2YgaW9zbGlkZXMsIHdoaWNoCiAgICAgICAgICAvLyBmbGlwcyBzbGlkZXMgYmV0d2VlbiBkaXNwbGF5Om5vbmUgYW5kIGRpc3BsYXk6YmxvY2suCiAgICAgICAgICAvLyBJZGVhbGx5IHdlIHdvdWxkIG5vdCBoYXZlIHRvIGhhdmUgaW9zbGlkZS1zcGVjaWZpYyBjb2RlCiAgICAgICAgICAvLyBoZXJlLCBidXQgcmF0aGVyIGhhdmUgaW9zbGlkZXMgcmFpc2UgYSBnZW5lcmljIGV2ZW50LAogICAgICAgICAgLy8gYnV0IHRoZSBybWFya2Rvd24gcGFja2FnZSBqdXN0IHdlbnQgdG8gQ1JBTiBzbyB0aGUKICAgICAgICAgIC8vIHdpbmRvdyB0byBnZXR0aW5nIHRoYXQgZml4ZWQgbWF5IGJlIGxvbmcuCiAgICAgICAgICBpZiAod2luZG93LmFkZEV2ZW50TGlzdGVuZXIpIHsKICAgICAgICAgICAgLy8gSXQncyBPSyB0byBsaW1pdCB0aGlzIHRvIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyCiAgICAgICAgICAgIC8vIGJyb3dzZXJzIGJlY2F1c2UgaW9zbGlkZXMgaXRzZWxmIG9ubHkgc3VwcG9ydHMKICAgICAgICAgICAgLy8gc3VjaCBicm93c2Vycy4KICAgICAgICAgICAgb24oZG9jdW1lbnQsICJzbGlkZWVudGVyIiwgcmVzaXplSGFuZGxlcik7CiAgICAgICAgICAgIG9uKGRvY3VtZW50LCAic2xpZGVsZWF2ZSIsIHJlc2l6ZUhhbmRsZXIpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIHNjcmlwdERhdGEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJzY3JpcHRbZGF0YS1mb3I9JyIgKyBlbC5pZCArICInXVt0eXBlPSdhcHBsaWNhdGlvbi9qc29uJ10iKTsKICAgICAgICBpZiAoc2NyaXB0RGF0YSkgewogICAgICAgICAgdmFyIGRhdGEgPSBKU09OLnBhcnNlKHNjcmlwdERhdGEudGV4dENvbnRlbnQgfHwgc2NyaXB0RGF0YS50ZXh0KTsKICAgICAgICAgIC8vIFJlc29sdmUgc3RyaW5ncyBtYXJrZWQgYXMgamF2YXNjcmlwdCBsaXRlcmFscyB0byBvYmplY3RzCiAgICAgICAgICBpZiAoIShkYXRhLmV2YWxzIGluc3RhbmNlb2YgQXJyYXkpKSBkYXRhLmV2YWxzID0gW2RhdGEuZXZhbHNdOwogICAgICAgICAgZm9yICh2YXIgayA9IDA7IGRhdGEuZXZhbHMgJiYgayA8IGRhdGEuZXZhbHMubGVuZ3RoOyBrKyspIHsKICAgICAgICAgICAgd2luZG93LkhUTUxXaWRnZXRzLmV2YWx1YXRlU3RyaW5nTWVtYmVyKGRhdGEueCwgZGF0YS5ldmFsc1trXSk7CiAgICAgICAgICB9CiAgICAgICAgICBiaW5kaW5nLnJlbmRlclZhbHVlKGVsLCBkYXRhLngsIGluaXRSZXN1bHQpOwogICAgICAgICAgZXZhbEFuZFJ1bihkYXRhLmpzSG9va3MucmVuZGVyLCBpbml0UmVzdWx0LCBbZWwsIGRhdGEueF0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKCiAgICBpbnZva2VQb3N0UmVuZGVySGFuZGxlcnMoKTsKICB9CgogIC8vIFdhaXQgdW50aWwgYWZ0ZXIgdGhlIGRvY3VtZW50IGhhcyBsb2FkZWQgdG8gcmVuZGVyIHRoZSB3aWRnZXRzLgogIGlmIChkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKSB7CiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgZnVuY3Rpb24oKSB7CiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCBhcmd1bWVudHMuY2FsbGVlLCBmYWxzZSk7CiAgICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTsKICAgIH0sIGZhbHNlKTsKICB9IGVsc2UgaWYgKGRvY3VtZW50LmF0dGFjaEV2ZW50KSB7CiAgICBkb2N1bWVudC5hdHRhY2hFdmVudCgib25yZWFkeXN0YXRlY2hhbmdlIiwgZnVuY3Rpb24oKSB7CiAgICAgIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSAiY29tcGxldGUiKSB7CiAgICAgICAgZG9jdW1lbnQuZGV0YWNoRXZlbnQoIm9ucmVhZHlzdGF0ZWNoYW5nZSIsIGFyZ3VtZW50cy5jYWxsZWUpOwogICAgICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTsKICAgICAgfQogICAgfSk7CiAgfQoKCiAgd2luZG93LkhUTUxXaWRnZXRzLmdldEF0dGFjaG1lbnRVcmwgPSBmdW5jdGlvbihkZXBuYW1lLCBrZXkpIHsKICAgIC8vIElmIG5vIGtleSwgZGVmYXVsdCB0byB0aGUgZmlyc3QgaXRlbQogICAgaWYgKHR5cGVvZihrZXkpID09PSAidW5kZWZpbmVkIikKICAgICAga2V5ID0gMTsKCiAgICB2YXIgbGluayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGRlcG5hbWUgKyAiLSIgKyBrZXkgKyAiLWF0dGFjaG1lbnQiKTsKICAgIGlmICghbGluaykgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIkF0dGFjaG1lbnQgIiArIGRlcG5hbWUgKyAiLyIgKyBrZXkgKyAiIG5vdCBmb3VuZCBpbiBkb2N1bWVudCIpOwogICAgfQogICAgcmV0dXJuIGxpbmsuZ2V0QXR0cmlidXRlKCJocmVmIik7CiAgfTsKCiAgd2luZG93LkhUTUxXaWRnZXRzLmRhdGFmcmFtZVRvRDMgPSBmdW5jdGlvbihkZikgewogICAgdmFyIG5hbWVzID0gW107CiAgICB2YXIgbGVuZ3RoOwogICAgZm9yICh2YXIgbmFtZSBpbiBkZikgewogICAgICAgIGlmIChkZi5oYXNPd25Qcm9wZXJ0eShuYW1lKSkKICAgICAgICAgICAgbmFtZXMucHVzaChuYW1lKTsKICAgICAgICBpZiAodHlwZW9mKGRmW25hbWVdKSAhPT0gIm9iamVjdCIgfHwgdHlwZW9mKGRmW25hbWVdLmxlbmd0aCkgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQWxsIGZpZWxkcyBtdXN0IGJlIGFycmF5cyIpOwogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mKGxlbmd0aCkgIT09ICJ1bmRlZmluZWQiICYmIGxlbmd0aCAhPT0gZGZbbmFtZV0ubGVuZ3RoKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQWxsIGZpZWxkcyBtdXN0IGJlIGFycmF5cyBvZiB0aGUgc2FtZSBsZW5ndGgiKTsKICAgICAgICB9CiAgICAgICAgbGVuZ3RoID0gZGZbbmFtZV0ubGVuZ3RoOwogICAgfQogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIHZhciBpdGVtOwogICAgZm9yICh2YXIgcm93ID0gMDsgcm93IDwgbGVuZ3RoOyByb3crKykgewogICAgICAgIGl0ZW0gPSB7fTsKICAgICAgICBmb3IgKHZhciBjb2wgPSAwOyBjb2wgPCBuYW1lcy5sZW5ndGg7IGNvbCsrKSB7CiAgICAgICAgICAgIGl0ZW1bbmFtZXNbY29sXV0gPSBkZltuYW1lc1tjb2xdXVtyb3ddOwogICAgICAgIH0KICAgICAgICByZXN1bHRzLnB1c2goaXRlbSk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0czsKICB9OwoKICB3aW5kb3cuSFRNTFdpZGdldHMudHJhbnNwb3NlQXJyYXkyRCA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICAgIGlmIChhcnJheS5sZW5ndGggPT09IDApIHJldHVybiBhcnJheTsKICAgICAgdmFyIG5ld0FycmF5ID0gYXJyYXlbMF0ubWFwKGZ1bmN0aW9uKGNvbCwgaSkgewogICAgICAgICAgcmV0dXJuIGFycmF5Lm1hcChmdW5jdGlvbihyb3cpIHsKICAgICAgICAgICAgICByZXR1cm4gcm93W2ldCiAgICAgICAgICB9KQogICAgICB9KTsKICAgICAgcmV0dXJuIG5ld0FycmF5OwogIH07CiAgLy8gU3BsaXQgdmFsdWUgYXQgc3BsaXRDaGFyLCBidXQgYWxsb3cgc3BsaXRDaGFyIHRvIGJlIGVzY2FwZWQKICAvLyB1c2luZyBlc2NhcGVDaGFyLiBBbnkgb3RoZXIgY2hhcmFjdGVycyBlc2NhcGVkIGJ5IGVzY2FwZUNoYXIKICAvLyB3aWxsIGJlIGluY2x1ZGVkIGFzIHVzdWFsIChpbmNsdWRpbmcgZXNjYXBlQ2hhciBpdHNlbGYpLgogIGZ1bmN0aW9uIHNwbGl0V2l0aEVzY2FwZSh2YWx1ZSwgc3BsaXRDaGFyLCBlc2NhcGVDaGFyKSB7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgdmFyIGVzY2FwZU1vZGUgPSBmYWxzZTsKICAgIHZhciBjdXJyZW50UmVzdWx0ID0gIiI7CiAgICBmb3IgKHZhciBwb3MgPSAwOyBwb3MgPCB2YWx1ZS5sZW5ndGg7IHBvcysrKSB7CiAgICAgIGlmICghZXNjYXBlTW9kZSkgewogICAgICAgIGlmICh2YWx1ZVtwb3NdID09PSBzcGxpdENoYXIpIHsKICAgICAgICAgIHJlc3VsdHMucHVzaChjdXJyZW50UmVzdWx0KTsKICAgICAgICAgIGN1cnJlbnRSZXN1bHQgPSAiIjsKICAgICAgICB9IGVsc2UgaWYgKHZhbHVlW3Bvc10gPT09IGVzY2FwZUNoYXIpIHsKICAgICAgICAgIGVzY2FwZU1vZGUgPSB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjdXJyZW50UmVzdWx0ICs9IHZhbHVlW3Bvc107CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGN1cnJlbnRSZXN1bHQgKz0gdmFsdWVbcG9zXTsKICAgICAgICBlc2NhcGVNb2RlID0gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIGlmIChjdXJyZW50UmVzdWx0ICE9PSAiIikgewogICAgICByZXN1bHRzLnB1c2goY3VycmVudFJlc3VsdCk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0czsKICB9CiAgLy8gRnVuY3Rpb24gYXV0aG9yZWQgYnkgWWlodWkvSkogQWxsYWlyZQogIHdpbmRvdy5IVE1MV2lkZ2V0cy5ldmFsdWF0ZVN0cmluZ01lbWJlciA9IGZ1bmN0aW9uKG8sIG1lbWJlcikgewogICAgdmFyIHBhcnRzID0gc3BsaXRXaXRoRXNjYXBlKG1lbWJlciwgJy4nLCAnXFwnKTsKICAgIGZvciAodmFyIGkgPSAwLCBsID0gcGFydHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgIHZhciBwYXJ0ID0gcGFydHNbaV07CiAgICAgIC8vIHBhcnQgbWF5IGJlIGEgY2hhcmFjdGVyIG9yICdudW1lcmljJyBtZW1iZXIgbmFtZQogICAgICBpZiAobyAhPT0gbnVsbCAmJiB0eXBlb2YgbyA9PT0gIm9iamVjdCIgJiYgcGFydCBpbiBvKSB7CiAgICAgICAgaWYgKGkgPT0gKGwgLSAxKSkgeyAvLyBpZiB3ZSBhcmUgYXQgdGhlIGVuZCBvZiB0aGUgbGluZSB0aGVuIGV2YWx1bGF0ZQogICAgICAgICAgaWYgKHR5cGVvZiBvW3BhcnRdID09PSAic3RyaW5nIikKICAgICAgICAgICAgb1twYXJ0XSA9IGV2YWwoIigiICsgb1twYXJ0XSArICIpIik7CiAgICAgICAgfSBlbHNlIHsgLy8gb3RoZXJ3aXNlIGNvbnRpbnVlIHRvIG5leHQgZW1iZWRkZWQgb2JqZWN0CiAgICAgICAgICBvID0gb1twYXJ0XTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwoKICAvLyBSZXRyaWV2ZSB0aGUgSFRNTFdpZGdldCBpbnN0YW5jZSAoaS5lLiB0aGUgcmV0dXJuIHZhbHVlIG9mIGFuCiAgLy8gSFRNTFdpZGdldCBiaW5kaW5nJ3MgaW5pdGlhbGl6ZSgpIG9yIGZhY3RvcnkoKSBmdW5jdGlvbikKICAvLyBhc3NvY2lhdGVkIHdpdGggYW4gZWxlbWVudCwgb3IgbnVsbCBpZiBub25lLgogIHdpbmRvdy5IVE1MV2lkZ2V0cy5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uKGVsKSB7CiAgICByZXR1cm4gZWxlbWVudERhdGEoZWwsICJpbml0X3Jlc3VsdCIpOwogIH07CgogIC8vIEZpbmRzIHRoZSBmaXJzdCBlbGVtZW50IGluIHRoZSBzY29wZSB0aGF0IG1hdGNoZXMgdGhlIHNlbGVjdG9yLAogIC8vIGFuZCByZXR1cm5zIHRoZSBIVE1MV2lkZ2V0IGluc3RhbmNlIChpLmUuIHRoZSByZXR1cm4gdmFsdWUgb2YKICAvLyBhbiBIVE1MV2lkZ2V0IGJpbmRpbmcncyBpbml0aWFsaXplKCkgb3IgZmFjdG9yeSgpIGZ1bmN0aW9uKQogIC8vIGFzc29jaWF0ZWQgd2l0aCB0aGF0IGVsZW1lbnQsIGlmIGFueS4gSWYgbm8gZWxlbWVudCBtYXRjaGVzIHRoZQogIC8vIHNlbGVjdG9yLCBvciB0aGUgZmlyc3QgbWF0Y2hpbmcgZWxlbWVudCBoYXMgbm8gSFRNTFdpZGdldAogIC8vIGluc3RhbmNlIGFzc29jaWF0ZWQgd2l0aCBpdCwgdGhlbiBudWxsIGlzIHJldHVybmVkLgogIC8vCiAgLy8gVGhlIHNjb3BlIGFyZ3VtZW50IGlzIG9wdGlvbmFsLCBhbmQgZGVmYXVsdHMgdG8gd2luZG93LmRvY3VtZW50LgogIHdpbmRvdy5IVE1MV2lkZ2V0cy5maW5kID0gZnVuY3Rpb24oc2NvcGUsIHNlbGVjdG9yKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAxKSB7CiAgICAgIHNlbGVjdG9yID0gc2NvcGU7CiAgICAgIHNjb3BlID0gZG9jdW1lbnQ7CiAgICB9CgogICAgdmFyIGVsID0gc2NvcGUucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7CiAgICBpZiAoZWwgPT09IG51bGwpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gd2luZG93LkhUTUxXaWRnZXRzLmdldEluc3RhbmNlKGVsKTsKICAgIH0KICB9OwoKICAvLyBGaW5kcyBhbGwgZWxlbWVudHMgaW4gdGhlIHNjb3BlIHRoYXQgbWF0Y2ggdGhlIHNlbGVjdG9yLCBhbmQKICAvLyByZXR1cm5zIHRoZSBIVE1MV2lkZ2V0IGluc3RhbmNlcyAoaS5lLiB0aGUgcmV0dXJuIHZhbHVlcyBvZgogIC8vIGFuIEhUTUxXaWRnZXQgYmluZGluZydzIGluaXRpYWxpemUoKSBvciBmYWN0b3J5KCkgZnVuY3Rpb24pCiAgLy8gYXNzb2NpYXRlZCB3aXRoIHRoZSBlbGVtZW50cywgaW4gYW4gYXJyYXkuIElmIGVsZW1lbnRzIHRoYXQKICAvLyBtYXRjaCB0aGUgc2VsZWN0b3IgZG9uJ3QgaGF2ZSBhbiBhc3NvY2lhdGVkIEhUTUxXaWRnZXQKICAvLyBpbnN0YW5jZSwgdGhlIHJldHVybmVkIGFycmF5IHdpbGwgY29udGFpbiBudWxscy4KICAvLwogIC8vIFRoZSBzY29wZSBhcmd1bWVudCBpcyBvcHRpb25hbCwgYW5kIGRlZmF1bHRzIHRvIHdpbmRvdy5kb2N1bWVudC4KICB3aW5kb3cuSFRNTFdpZGdldHMuZmluZEFsbCA9IGZ1bmN0aW9uKHNjb3BlLCBzZWxlY3RvcikgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMSkgewogICAgICBzZWxlY3RvciA9IHNjb3BlOwogICAgICBzY29wZSA9IGRvY3VtZW50OwogICAgfQoKICAgIHZhciBub2RlcyA9IHNjb3BlLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpOwogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgcmVzdWx0cy5wdXNoKHdpbmRvdy5IVE1MV2lkZ2V0cy5nZXRJbnN0YW5jZShub2Rlc1tpXSkpOwogICAgfQogICAgcmV0dXJuIHJlc3VsdHM7CiAgfTsKCiAgdmFyIHBvc3RSZW5kZXJIYW5kbGVycyA9IFtdOwogIGZ1bmN0aW9uIGludm9rZVBvc3RSZW5kZXJIYW5kbGVycygpIHsKICAgIHdoaWxlIChwb3N0UmVuZGVySGFuZGxlcnMubGVuZ3RoKSB7CiAgICAgIHZhciBoYW5kbGVyID0gcG9zdFJlbmRlckhhbmRsZXJzLnNoaWZ0KCk7CiAgICAgIGlmIChoYW5kbGVyKSB7CiAgICAgICAgaGFuZGxlcigpOwogICAgICB9CiAgICB9CiAgfQoKICAvLyBSZWdpc3RlciB0aGUgZ2l2ZW4gY2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgaW52b2tlZCBhZnRlciB0aGUKICAvLyBuZXh0IHRpbWUgc3RhdGljIHdpZGdldHMgYXJlIHJlbmRlcmVkLgogIHdpbmRvdy5IVE1MV2lkZ2V0cy5hZGRQb3N0UmVuZGVySGFuZGxlciA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICBwb3N0UmVuZGVySGFuZGxlcnMucHVzaChjYWxsYmFjayk7CiAgfTsKCiAgLy8gVGFrZXMgYSBuZXctc3R5bGUgaW5zdGFuY2UtYm91bmQgZGVmaW5pdGlvbiwgYW5kIHJldHVybnMgYW4KICAvLyBvbGQtc3R5bGUgY2xhc3MtYm91bmQgZGVmaW5pdGlvbi4gVGhpcyBzYXZlcyB1cyBmcm9tIGhhdmluZwogIC8vIHRvIHJld3JpdGUgYWxsIHRoZSBsb2dpYyBpbiB0aGlzIGZpbGUgdG8gYWNjb21vZGF0ZSBib3RoCiAgLy8gdHlwZXMgb2YgZGVmaW5pdGlvbnMuCiAgZnVuY3Rpb24gY3JlYXRlTGVnYWN5RGVmaW5pdGlvbkFkYXB0ZXIoZGVmbikgewogICAgdmFyIHJlc3VsdCA9IHsKICAgICAgbmFtZTogZGVmbi5uYW1lLAogICAgICB0eXBlOiBkZWZuLnR5cGUsCiAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKGVsLCB3aWR0aCwgaGVpZ2h0KSB7CiAgICAgICAgcmV0dXJuIGRlZm4uZmFjdG9yeShlbCwgd2lkdGgsIGhlaWdodCk7CiAgICAgIH0sCiAgICAgIHJlbmRlclZhbHVlOiBmdW5jdGlvbihlbCwgeCwgaW5zdGFuY2UpIHsKICAgICAgICByZXR1cm4gaW5zdGFuY2UucmVuZGVyVmFsdWUoeCk7CiAgICAgIH0sCiAgICAgIHJlc2l6ZTogZnVuY3Rpb24oZWwsIHdpZHRoLCBoZWlnaHQsIGluc3RhbmNlKSB7CiAgICAgICAgcmV0dXJuIGluc3RhbmNlLnJlc2l6ZSh3aWR0aCwgaGVpZ2h0KTsKICAgICAgfQogICAgfTsKCiAgICBpZiAoZGVmbi5maW5kKQogICAgICByZXN1bHQuZmluZCA9IGRlZm4uZmluZDsKICAgIGlmIChkZWZuLnJlbmRlckVycm9yKQogICAgICByZXN1bHQucmVuZGVyRXJyb3IgPSBkZWZuLnJlbmRlckVycm9yOwogICAgaWYgKGRlZm4uY2xlYXJFcnJvcikKICAgICAgcmVzdWx0LmNsZWFyRXJyb3IgPSBkZWZuLmNsZWFyRXJyb3I7CgogICAgcmV0dXJuIHJlc3VsdDsKICB9Cn0pKCk7Cgo="></script>
<link href="data:text/css;charset=utf-8,%2EdisplayWidget%20%7B%0Amargin%3A%200%3B%0Apadding%3A%200%3B%0Aborder%3A%200%3B%0Abackground%2Dcolor%3A%20%23dddddd%3B%0Aoverflow%3A%20hidden%3B%0A%7D%0A%2Eebimage%20%7B%0Adisplay%3A%20block%3B%0Amargin%3A%200%3B%0Apadding%3A%200%3B%0Aborder%3A%200%3B%0Aoverflow%3A%20hidden%3B%0A%7D%0A%2Eebimage%2Dtoolbar%20%7B%0Aoverflow%3A%20inherit%3B%0Amin%2Dwidth%3A%20128px%3B%0A%7D%0A%2Eebimage%2Dbuttons%2Dnav%2C%20%2Eebimage%2Dbuttons%2Dzoom%20%7B%0Afloat%3A%20left%3B%0Awidth%3A%2050%25%3B%0Amin%2Dwidth%3A%20128px%3B%0A%7D%0A%2Eebimage%2Dbuttons%2Dzoom%20%7B%0Atext%2Dalign%3A%20right%3B%0Amargin%2Dright%3A%20%2D1px%3B%0A%7D%0A%2Eebimage%2Dbuttons%2Dnav%20%7B%0Afont%2Dsize%3A%2020px%3B%0A%7D%0A%2Eebimage%2Dbuttons%2Dzoom%20%7B%0Afont%2Dsize%3A%2016px%3B%0A%7D%0A%2Eebimage%2Dbutton%20%7B%0Afont%2Dfamily%3A%20Arial%2Csans%2Dserif%3B%0Afont%2Dsize%3A%20inherit%3B%0Afont%2Dweight%3A%20bold%3B%0Awidth%3A%2032px%3B%0Aheight%3A%2032px%3B%0Apadding%3A%200%3B%0Avertical%2Dalign%3A%20top%3B%0A%7D%0A%2Ebtn%2Dorg%20%7B%0Afont%2Dsize%3A%2012px%3B%0A%7D%0A%2Ebtn%2Dfit%20%7B%0Aline%2Dheight%3A%200px%3B%0A%7D%0A%2Eebimage%2Dcanvas%20%7B%0Aposition%3A%20relative%3B%0Az%2Dindex%3A%201%3B%0Abackground%2Dcolor%3A%20%23222222%3B%0A%7D%0A%2Eebimage%2Dimage%20%7B%0Amax%2Dwidth%3A%20none%3B%0Aposition%3A%20absolute%3B%0Az%2Dindex%3A%202%3B%0Acursor%3A%20crosshair%3B%0Aimage%2Drendering%3AoptimizeSpeed%3B%20%0Aimage%2Drendering%3A%2Dmoz%2Dcrisp%2Dedges%3B%20%0Aimage%2Drendering%3A%2Do%2Dcrisp%2Dedges%3B%20%0Aimage%2Drendering%3A%2Dwebkit%2Doptimize%2Dcontrast%3B%20%0Aimage%2Drendering%3Aoptimize%2Dcontrast%3B%20%0A%2Dms%2Dinterpolation%2Dmode%3Anearest%2Dneighbor%3B%20%0A%7D%0A%2Eebimage%2Dstatus%20%7B%0Afont%2Dsize%3A%2014px%3B%0Afont%2Dfamily%3A%20%22Lucida%20Console%22%2C%20Monaco%2C%20monospace%3B%0Amargin%2Dright%3A%2010px%3B%0Apadding%3A%201px%3B%0Afloat%3A%20left%3B%0A%7D%0A%2Eebimage%2Dhelp%20%7B%0Aposition%3A%20relative%3B%0Amargin%3A%20auto%3B%0Atop%3A%2050px%3B%0Awidth%3A%20360px%3B%0Aborder%2Dradius%3A%2010px%3B%0Aoverflow%3A%20auto%3B%0Aborder%3A%201px%20solid%20%23eeeeee%3B%0Az%2Dindex%3A%203%3B%0Adisplay%3A%20none%3B%0A%7D%0A%2Eebimage%2Dhelp%2Dkey%20%7B%0Afont%2Dfamily%3A%20%22Lucida%20Console%22%2C%20Monaco%2C%20monospace%3B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0A%2Eebimage%2Dhelp%2Dtopic%20%7B%0Afont%2Dsize%3A%2014px%3B%0Afont%2Dweight%3A%20bold%3B%0Apadding%2Dtop%3A%205px%3B%0A%7D%0A%2Eebimage%2Dhelp%2Dclose%20%7B%0Atext%2Dalign%3A%20center%3B%0Afont%2Dweight%3A%20bold%3B%0Apadding%3A%205px%3B%0A%7D%0A%2Eebimage%2Dhelp%2Dtable%20%7B%0Abackground%2Dcolor%3A%20white%3B%0Aopacity%3A%200%2E8%3B%0Aborder%2Dradius%3A%208px%3B%0Apadding%2Dleft%3A%205px%3B%0Apadding%2Dright%3A%205px%3B%0Afont%2Dsize%3A%2012px%3B%0Afont%2Dfamily%3A%20Tahoma%2C%20Geneva%2C%20sans%2Dserif%3B%0A%7D%0A" rel="stylesheet" />
<script src="data:application/x-javascript;base64,LyoKCUVCSW1hZ2UgSmF2YVNjcmlwdCBJbWFnZSBWaWV3ZXIKCUNvcHlyaWdodCAoYykgMjAxMiBBbmRyemVqIE9sZXMKKi8KCmZ1bmN0aW9uIFZpZXdlcihwYXJlbnQpewogIHZhciB2aWV3ZXIgPSB0aGlzOwoJdmFyIGRhdGEgPSBudWxsOwogIHZhciBudW1iZXJPZkZyYW1lcyA9IDA7CgogIHZhciBvcmlnaW5hbFdpZHRoIAk9IDA7CiAgdmFyIG9yaWdpbmFsSGVpZ2h0CT0gMDsKCgl2YXIgY3VycmVudEZyYW1lID0gMTsKCXZhciB6b29tTGV2ZWwgPSBudWxsLCBtaW5ab29tTGV2ZWwgPSAtMTIsIG1heFpvb21MZXZlbCA9IDY7IC8vICd6b29tTGV2ZWwgPT0gMCcgaXMgMTAwJSwgJ3pvb21MZXZlbCA9PSBudWxsJyBpcyBhdXRvZml0Cgl2YXIgcHJldmlvdXNNb3VzZVBvc2l0aW9uID0gbnVsbDsKCXZhciBiYXNlTW91c2VTcGVlZCA9IGN1cnJlbnRNb3VzZVNwZWVkID0gbWluTW91c2VTcGVlZCA9IDI7CgoJLy8gdmlldmVyIERPTSBlbGVtZW50cwoJdmFyIGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChwYXJlbnQpOwoJdmFyIGNhbnZhcyA9IG51bGw7Cgl2YXIgaW1hZ2UgPSBudWxsOwoJdmFyIHRvb2xiYXIgPSBudWxsOwoJdmFyIHN0YXR1c2JhciA9IG51bGw7Cgl2YXIgaGVscCA9IG51bGw7Cgl2YXIgYnV0dG9ucyA9IFtdOwoJdmFyIHN0YXR1cyA9IFtdOwoJCgl2YXIgbmF2RW5hYmxlZCA9IHsKCSAgZmlyc3Q6ICI8aW1nIHNyYz0nZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhabGNuTnBiMjQ5SWpFdU1TSWdkMmxrZEdnOUlqRTJJaUJvWldsbmFIUTlJakUySWo0TkNpQWdQSEJ2YkhsbmIyNGdjRzlwYm5SelBTSXhOaXcwSURrc09DQXhOaXd4TWlJZ2MzUjViR1U5SW1acGJHdzZZbXhoWTJzN0lpOCtEUW9nSUR4d2IyeDVaMjl1SUhCdmFXNTBjejBpT1N3MElESXNPQ0E1TERFeUlpQnpkSGxzWlQwaVptbHNiRHBpYkdGamF6c2lMejROQ2lBZ1BIQnZiSGxuYjI0Z2NHOXBiblJ6UFNJeUxEUWdNU3cwSURFc01USWdNaXd4TWlJZ2MzUjViR1U5SW1acGJHdzZZbXhoWTJzN0lpOCtEUW84TDNOMlp6ND0nPiIsCgkgIHByZXY6ICI8aW1nIHNyYz0nZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhabGNuTnBiMjQ5SWpFdU1TSWdkMmxrZEdnOUlqRTJJaUJvWldsbmFIUTlJakUySWo0TkNpQWdQSEJ2YkhsbmIyNGdjRzlwYm5SelBTSXhNU3cwSURRc09DQXhNU3d4TWlJZ2MzUjViR1U5SW1acGJHdzZZbXhoWTJzN0lpOCtEUW84TDNOMlp6ND0nPiIsCgkgIG5leHQ6ICI8aW1nIHNyYz0nZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhabGNuTnBiMjQ5SWpFdU1TSWdkMmxrZEdnOUlqRTJJaUJvWldsbmFIUTlJakUySWo0TkNpQWdQSEJ2YkhsbmIyNGdjRzlwYm5SelBTSTFMRFFnTVRJc09DQTFMREV5SWlCemRIbHNaVDBpWm1sc2JEcGliR0ZqYXpzaUx6NE5Dand2YzNablBnPT0nPiIsCgkgIGxhc3Q6ICI8aW1nIHNyYz0nZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhabGNuTnBiMjQ5SWpFdU1TSWdkMmxrZEdnOUlqRTJJaUJvWldsbmFIUTlJakUySWo0TkNpQWdQSEJ2YkhsbmIyNGdjRzlwYm5SelBTSXdMRFFnTnl3NElEQXNNVElpSUhOMGVXeGxQU0ptYVd4c09tSnNZV05yT3lJdlBnMEtJQ0E4Y0c5c2VXZHZiaUJ3YjJsdWRITTlJamNzTkNBeE5DdzRJRGNzTVRJaUlITjBlV3hsUFNKbWFXeHNPbUpzWVdOck95SXZQZzBLSUNBOGNHOXNlV2R2YmlCd2IybHVkSE05SWpFMExEUWdNVFVzTkNBeE5Td3hNaUF4TkN3eE1pSWdjM1I1YkdVOUltWnBiR3c2WW14aFkyczdJaTgrRFFvOEwzTjJaejQ9Jz4iCgl9OwoJdmFyIG5hdkRpc2FibGVkID0gewoJICBmaXJzdDoKCSI8aW1nIHNyYz0nZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhabGNuTnBiMjQ5SWpFdU1TSWdkMmxrZEdnOUlqRTJJaUJvWldsbmFIUTlJakUySWo0TkNpQWdQSEJ2YkhsbmIyNGdjRzlwYm5SelBTSXhOaXcwSURrc09DQXhOaXd4TWlJZ2MzUjViR1U5SW1acGJHdzZJemd3T0RBNE1Ec2lMejROQ2lBZ1BIQnZiSGxuYjI0Z2NHOXBiblJ6UFNJNUxEUWdNaXc0SURrc01USWlJSE4wZVd4bFBTSm1hV3hzT2lNNE1EZ3dPREE3SWk4K0RRb2dJRHh3YjJ4NVoyOXVJSEJ2YVc1MGN6MGlNaXcwSURFc05DQXhMREV5SURJc01USWlJSE4wZVd4bFBTSm1hV3hzT2lNNE1EZ3dPREE3SWk4K0RRbzhMM04yWno0PSc+IiwKCSAgcHJldjogIjxpbWcgc3JjPSdkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSFpsY25OcGIyNDlJakV1TVNJZ2QybGtkR2c5SWpFMklpQm9aV2xuYUhROUlqRTJJajROQ2lBZ1BIQnZiSGxuYjI0Z2NHOXBiblJ6UFNJeE1TdzBJRFFzT0NBeE1Td3hNaUlnYzNSNWJHVTlJbVpwYkd3Nkl6Z3dPREE0TURzaUx6NE5Dand2YzNablBnPT0nPiIsCgkgIG5leHQ6ICI8aW1nIHNyYz0nZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhabGNuTnBiMjQ5SWpFdU1TSWdkMmxrZEdnOUlqRTJJaUJvWldsbmFIUTlJakUySWo0TkNpQWdQSEJ2YkhsbmIyNGdjRzlwYm5SelBTSTFMRFFnTVRJc09DQTFMREV5SWlCemRIbHNaVDBpWm1sc2JEb2pPREE0TURnd095SXZQZzBLUEM5emRtYysnPiIsCgkgIGxhc3Q6ICI8aW1nIHNyYz0nZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhabGNuTnBiMjQ5SWpFdU1TSWdkMmxrZEdnOUlqRTJJaUJvWldsbmFIUTlJakUySWo0TkNpQWdQSEJ2YkhsbmIyNGdjRzlwYm5SelBTSXdMRFFnTnl3NElEQXNNVElpSUhOMGVXeGxQU0ptYVd4c09pTTRNRGd3T0RBN0lpOCtEUW9nSUR4d2IyeDVaMjl1SUhCdmFXNTBjejBpTnl3MElERTBMRGdnTnl3eE1pSWdjM1I1YkdVOUltWnBiR3c2SXpnd09EQTRNRHNpTHo0TkNpQWdQSEJ2YkhsbmIyNGdjRzlwYm5SelBTSXhOQ3cwSURFMUxEUWdNVFVzTVRJZ01UUXNNVElpSUhOMGVXeGxQU0ptYVd4c09pTTRNRGd3T0RBN0lpOCtEUW84TDNOMlp6ND0nPiIKCX07CgkKLyogSW50ZXJuYWwgZnVuY3Rpb25zICovCgoJdGhpcy5zZXRJbWFnZVBvc2l0aW9uID0gZnVuY3Rpb24oeCwgeSkgewoJCWltYWdlLnN0eWxlLmxlZnQ9KE1hdGgucm91bmQoeCkrJ3B4Jyk7CgkJaW1hZ2Uuc3R5bGUudG9wPShNYXRoLnJvdW5kKHkpKydweCcpOwoJfQoJdGhpcy5nZXRJbWFnZVBvc2l0aW9uID0gZnVuY3Rpb24oKSB7CgkJcmV0dXJuIFtzdHJpcFVuaXRzKGltYWdlLnN0eWxlLmxlZnQsJ3B4JyksIHN0cmlwVW5pdHMoaW1hZ2Uuc3R5bGUudG9wLCdweCcpXTsKCX0KCgkvL3JldHVybiB6b29tIGZhY3RvciBnaXZlbiBhIHpvb20gbGV2ZWwKCXRoaXMuZ2V0Wm9vbUZhY3RvciA9IGZ1bmN0aW9uKHpvb21MZXZlbCkgewoJCWlmKHR5cGVvZiB6b29tTGV2ZWw9PSd1bmRlZmluZWQnKQoJCQl6b29tTGV2ZWw9em9vbUxldmVsOwoJCWlmKHpvb21MZXZlbD09bnVsbCkKCQkJcmV0dXJuIGltYWdlLndpZHRoL29yaWdpbmFsV2lkdGg7CgkJZWxzZSBpZih6b29tTGV2ZWw+PTApCgkJCS8vIGluY3JlYXNlIGJ5IGRvdWJsaW5nIHRoZSBzaXplCgkJCXJldHVybiBNYXRoLnBvdygyLCB6b29tTGV2ZWwpOwoJCWVsc2UKCQkJLy8gZGVjcmVhc2UgZWFjaCB0aW1lIGJ5IDEvMwoJCQlyZXR1cm4gTWF0aC5mbG9vcigxMDAgKiBNYXRoLnBvdygyLCBNYXRoLmNlaWwoem9vbUxldmVsLzIpICkgKiBNYXRoLnBvdygzLzIsIHpvb21MZXZlbCUyKSApIC8xMDA7Cgl9CgoJdGhpcy56b29tID0gZnVuY3Rpb24oZGlyLCB4LCB5KSB7IC8vIGRpcmVjdGlvbiA9IDEgKHpvb20gaW4pIG9yIC0xICh6b29tIG91dCkKCQlpZih6b29tTGV2ZWw9PW51bGwpewoJCQl6b29tTGV2ZWwgPSAwOwoJCQl2YXIgY3VycmVudFpvb21GYWN0b3IgPSBpbWFnZS53aWR0aC9vcmlnaW5hbFdpZHRoOwoKCQkJLy8gZmluZCBmcm9tIGFib3ZlCgkJCWlmKGN1cnJlbnRab29tRmFjdG9yID4gMSkKCQkJCXdoaWxlKHZpZXdlci5nZXRab29tRmFjdG9yKHpvb21MZXZlbCk8Y3VycmVudFpvb21GYWN0b3IpIHpvb21MZXZlbCsrOwoJCQllbHNlCgkJCQl3aGlsZSh2aWV3ZXIuZ2V0Wm9vbUZhY3Rvcih6b29tTGV2ZWwtMSk+PWN1cnJlbnRab29tRmFjdG9yKSB6b29tTGV2ZWwtLTsKCQkJaWYgKCAodmlld2VyLmdldFpvb21GYWN0b3Ioem9vbUxldmVsKSE9Y3VycmVudFpvb21GYWN0b3IpICYmIChkaXI9PTEpICkKCQkJCXpvb21MZXZlbC0tOwoJCX0KCQl2aWV3ZXIuem9vbVRvKHpvb21MZXZlbCtkaXIsIHgsIHkpOwoJfQoKCXRoaXMuem9vbVRvID0gZnVuY3Rpb24obmV3Wm9vbUxldmVsLCB4LCB5KSB7CgkJLy8gdmFsaWQgcmFuZ2U/CgkJaWYoIG5ld1pvb21MZXZlbDxtaW5ab29tTGV2ZWwgfHwgbmV3Wm9vbUxldmVsPm1heFpvb21MZXZlbCApCgkJCXJldHVybiBmYWxzZTsKCQkvLyB3aXRoaW4gdGhlIGNhbnZhcz8KCQlpZiggeDwwIHx8IHk8MCB8fCB4Pj1jYW52YXMuY2xpZW50V2lkdGggfHwgeT49Y2FudmFzLmNsaWVudEhlaWdodCApCgkJCXJldHVybiBmYWxzZTsKCgkJdmFyIHpvb21GYWN0b3IgPSB2aWV3ZXIuZ2V0Wm9vbUZhY3RvcihuZXdab29tTGV2ZWwpOwoJCXZhciBzaXplID0gW29yaWdpbmFsV2lkdGggKiB6b29tRmFjdG9yLCBvcmlnaW5hbEhlaWdodCAqIHpvb21GYWN0b3JdOwoJCXZhciBwb3NpdGlvbiA9IHZpZXdlci5nZXRJbWFnZVBvc2l0aW9uKCk7CgoJCXBvc2l0aW9uWzBdLT0oKHgtcG9zaXRpb25bMF0pKigoc2l6ZVswXS9pbWFnZS53aWR0aCktMSkpOwoJCXBvc2l0aW9uWzFdLT0oKHktcG9zaXRpb25bMV0pKigoc2l6ZVsxXS9pbWFnZS5oZWlnaHQpLTEpKTsKCgkJdmlld2VyLnVwZGF0ZUltYWdlKHNpemVbMF0sIHNpemVbMV0sIHBvc2l0aW9uWzBdLCBwb3NpdGlvblsxXSwgbmV3Wm9vbUxldmVsKTsKCgkJLy8gYnV0dG9uIGxvY2tpbmcKCQlidXR0b25zWydpbiddLmRpc2FibGUobmV3Wm9vbUxldmVsPT1tYXhab29tTGV2ZWwpOwoJCWJ1dHRvbnNbJ291dCddLmRpc2FibGUobmV3Wm9vbUxldmVsPT1taW5ab29tTGV2ZWwpOwoJCWJ1dHRvbnNbJ29yZyddLmRpc2FibGUodmlld2VyLmdldFpvb21GYWN0b3IoKT09MSk7CgkJYnV0dG9uc1snZml0J10uZGlzYWJsZShmYWxzZSkuc3R5bGUuY29sb3I9Jyc7CgoJCXJldHVybiB0cnVlOwoJfQoKCXRoaXMucmVzZXRab29tID0gZnVuY3Rpb24oKSB7CgkJem9vbUxldmVsID0gbnVsbDsKCgkJLy8gc2NhbGUgaW1hZ2UgZG93biB3aGVuIGl0cyBkaW1lbnNpb25zIGV4Y2VlZCBjYW52YXMgc2l6ZQoJCXZhciBjYW52YXNTaXplID0gW2NhbnZhcy5jbGllbnRXaWR0aCwgY2FudmFzLmNsaWVudEhlaWdodF07CgkJdmFyIGRvd25zY2FsZSA9ICggY2FudmFzU2l6ZVswXT5vcmlnaW5hbFdpZHRoICYmIGNhbnZhc1NpemVbMV0+b3JpZ2luYWxIZWlnaHQgKSA/IGZhbHNlIDogdHJ1ZTsKCQl2YXIgaW1hZ2VTaXplID0gZG93bnNjYWxlID8gdmlld2VyLmZpdFRvQ2FudmFzKCkgOiBbb3JpZ2luYWxXaWR0aCwgb3JpZ2luYWxIZWlnaHRdOwoKCQl2aWV3ZXIudXBkYXRlSW1hZ2UoaW1hZ2VTaXplWzBdLCBpbWFnZVNpemVbMV0sIDAsIDAsIHpvb21MZXZlbCk7CgoJCS8vIGxvY2sgYnV0dG9ucwoJCWJ1dHRvbnNbJ2ZpdCddLmRpc2FibGUodHJ1ZSkuc3R5bGUuY29sb3I9JyNGRjAwMDAnOwoJCWJ1dHRvbnNbJ29yZyddLmRpc2FibGUoIWRvd25zY2FsZSk7Cgl9CgoJdGhpcy51cGRhdGVJbWFnZSA9IGZ1bmN0aW9uKHcsIGgsIHgsIHksIG5ld1pvb21MZXZlbCkgewoJCS8vIHNldCBpbWFnZSBzaXplCgkJaW1hZ2Uud2lkdGggPSBNYXRoLnJvdW5kKHcpOwoJCWltYWdlLmhlaWdodCA9IE1hdGgucm91bmQoaCk7CgoJCS8vIHNldCBpbWFnZSBwb3NpdGlvbgoJCXZhciBwb3NpdGlvbiA9IHZpZXdlci5jZW50ZXJJbWFnZSh3LCBoLCB4ICx5KTsKCQl2aWV3ZXIuc2V0SW1hZ2VQb3NpdGlvbihwb3NpdGlvblswXSwgcG9zaXRpb25bMV0pOwoKCQl6b29tTGV2ZWwgPSBuZXdab29tTGV2ZWw7CgkJYmFzZU1vdXNlU3BlZWQgPSBjdXJyZW50TW91c2VTcGVlZCA9ICh2aWV3ZXIuZ2V0Wm9vbUZhY3RvcigpID4gbWluTW91c2VTcGVlZCkgPyBNYXRoLnJvdW5kKHZpZXdlci5nZXRab29tRmFjdG9yKCkpIDogbWluTW91c2VTcGVlZDsKCQl2aWV3ZXIudXBkYXRlU3RhdHVzRmllbGQoIlpvb20iLCBNYXRoLnJvdW5kKCAxMDAgKiB2aWV3ZXIuZ2V0Wm9vbUZhY3RvcigpICkrJyUnKTsKCX0KCgl0aGlzLmNlbnRlckltYWdlID0gZnVuY3Rpb24odywgaCwgeCwgeSkgewoJCXZhciBjYW52YXNTaXplID0gW2NhbnZhcy5jbGllbnRXaWR0aCwgY2FudmFzLmNsaWVudEhlaWdodF07CgoJCWlmKHc8PWNhbnZhc1NpemVbMF0pCgkJCXggPSBNYXRoLnJvdW5kKChjYW52YXNTaXplWzBdIC0gdykvMik7CgkJaWYoaDw9Y2FudmFzU2l6ZVsxXSkKCQkJeSA9IE1hdGgucm91bmQoKGNhbnZhc1NpemVbMV0gLSBoKS8yKTsKCgkJaWYodz5jYW52YXNTaXplWzBdKSB7CgkJCWlmKHg+MCkKCQkJCXg9MDsKCQkJZWxzZSBpZigoeCt3KTxjYW52YXNTaXplWzBdKQoJCQkJeD1jYW52YXNTaXplWzBdLXc7CgkJfQoKCQlpZihoPmNhbnZhc1NpemVbMV0pIHsKCQkJaWYoeT4wKQoJCQkJeT0wOwoJCQllbHNlIGlmKCh5K2gpPGNhbnZhc1NpemVbMV0pCgkJCQl5PWNhbnZhc1NpemVbMV0taDsKCQl9CgoJCXJldHVybiBbeCx5XTsKCX0KCgl0aGlzLmZpdFRvQ2FudmFzID0gZnVuY3Rpb24oKSB7CgkJdmFyIGNhbnZhc1NpemUgPSBbY2FudmFzLmNsaWVudFdpZHRoLCBjYW52YXMuY2xpZW50SGVpZ2h0XTsKCgkJdmFyIG5ld1dpZHRoID0gY2FudmFzU2l6ZVswXTsKCQl2YXIgbmV3SGVpZ2h0ID0gTWF0aC5yb3VuZCgobmV3V2lkdGgqb3JpZ2luYWxIZWlnaHQpL29yaWdpbmFsV2lkdGgpOwoJCWlmKG5ld0hlaWdodD4oY2FudmFzU2l6ZVsxXSkpIHsKCQkJbmV3SGVpZ2h0ID0gY2FudmFzU2l6ZVsxXTsKCQkJbmV3V2lkdGggPSBNYXRoLnJvdW5kKChuZXdIZWlnaHQqb3JpZ2luYWxXaWR0aCkvb3JpZ2luYWxIZWlnaHQpOwoJCX0KCQlyZXR1cm4gW25ld1dpZHRoLG5ld0hlaWdodF07Cgl9CgoJdGhpcy5tb3ZlSW1hZ2UgPSBmdW5jdGlvbih4LCB5KSB7CgkJdmFyIHBvc2l0aW9uID0gdmlld2VyLmdldEltYWdlUG9zaXRpb24oKTsKCQlwb3NpdGlvbiA9IHZpZXdlci5jZW50ZXJJbWFnZShpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0LCBwb3NpdGlvblswXSt4LCBwb3NpdGlvblsxXSt5KTsKCQl2aWV3ZXIuc2V0SW1hZ2VQb3NpdGlvbihwb3NpdGlvblswXSwgcG9zaXRpb25bMV0pOwoJfQoKCXRoaXMucmVzZXRDYW52YXMgPSBmdW5jdGlvbigpewoJCS8vIHJlY2FsY3VsYXRlIGNhbnZhcyBzaXplCgkJdmFyIHdpbmRvd1NpemUgPSBbYm9keS5jbGllbnRXaWR0aCwgYm9keS5jbGllbnRIZWlnaHRdOy8vZ2V0V2luZG93U2l6ZSgpOwoJCXZhciBuZXdDYW52YXNTaXplID0gW3dpbmRvd1NpemVbMF0sIHdpbmRvd1NpemVbMV0gLSAodG9vbGJhci5vZmZzZXRIZWlnaHQrc3RhdHVzYmFyLm9mZnNldEhlaWdodCldOwoJCS8vIHNldCBuZXcgY2FudmFzIHNpemUKCQljYW52YXMuc3R5bGUud2lkdGggPSAoTWF0aC5yb3VuZChuZXdDYW52YXNTaXplWzBdKSsncHgnKTsKCQljYW52YXMuc3R5bGUuaGVpZ2h0ID0gKE1hdGgucm91bmQobmV3Q2FudmFzU2l6ZVsxXSkrJ3B4Jyk7CgoJCS8vIHJlZHJhdyBpbWFnZSBvbiBjYW52YXMKCQlpZih6b29tTGV2ZWwgPT0gbnVsbCkKCQkJdmlld2VyLmF1dG9maXRJbWFnZSgpOwoJCWVsc2UKCQkJdmlld2VyLnpvb21Ubyh6b29tTGV2ZWwsIGNhbnZhcy5jbGllbnRXaWR0aC8yLCBjYW52YXMuY2xpZW50SGVpZ2h0LzIpOwoJfQoKCXRoaXMuc2V0RnJhbWUgPSBmdW5jdGlvbihmcmFtZSkgewoJCWlmKHR5cGVvZiBmcmFtZT09J3VuZGVmaW5lZCcpCgkJCWZyYW1lID0gMTsKCQlpZiggZnJhbWU8MSB8fCBmcmFtZT5udW1iZXJPZkZyYW1lcyApCgkJCXJldHVybiBmYWxzZTsKCgkJaW1hZ2Uuc3JjID0gZGF0YVsoZnJhbWUtMSldOwoKCQljdXJyZW50RnJhbWUgPSBmcmFtZTsKCQl2aWV3ZXIudXBkYXRlU3RhdHVzRmllbGQoIkZyYW1lIiwgY3VycmVudEZyYW1lKycvJytudW1iZXJPZkZyYW1lcyk7CgoJCS8vIGJ1dHRvbiBsb2NraW5nCgkJYnV0dG9uc1snZmlyc3QnXS5kaXNhYmxlKGN1cnJlbnRGcmFtZT09MSk7CgkJYnV0dG9uc1sncHJldiddLmRpc2FibGUoY3VycmVudEZyYW1lPT0xKTsKCQlidXR0b25zWyduZXh0J10uZGlzYWJsZShjdXJyZW50RnJhbWU9PW51bWJlck9mRnJhbWVzKTsKCQlidXR0b25zWydsYXN0J10uZGlzYWJsZShjdXJyZW50RnJhbWU9PW51bWJlck9mRnJhbWVzKTsKCgkJcmV0dXJuIHRydWU7Cgl9CgoJdGhpcy51cGRhdGVTdGF0dXNGaWVsZCA9IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7CgkJc3RhdHVzW25hbWVdLmlubmVySFRNTCA9IG5hbWUrJzogJyt2YWx1ZSsnJm5ic3A7JzsKCX0KCgl0aGlzLmNsZWFyU3RhdHVzRmllbGQgPSBmdW5jdGlvbihuYW1lKSB7CgkJc3RhdHVzW25hbWVdLmlubmVySFRNTCA9ICcnOwoJfQoKCXRoaXMuZ2V0UGl4ZWxQb3NpdGlvbiA9IGZ1bmN0aW9uKGV2ZW50KXsKCQl2YXIgbW91c2VQb3MgPSBnZXRNb3VzZVhZKGV2ZW50KTsKCQl2YXIgaW1hZ2VQb3MgPSBnZXRPYmplY3RYWShpbWFnZSk7CgkJdmFyIHpvb21GYWN0b3IgPSB2aWV3ZXIuZ2V0Wm9vbUZhY3RvcigpOwoJCXJldHVybiBbTWF0aC5mbG9vcigobW91c2VQb3NbMF0taW1hZ2VQb3NbMF0pL3pvb21GYWN0b3IpICsgMSwgTWF0aC5mbG9vcigobW91c2VQb3NbMV0taW1hZ2VQb3NbMV0pL3pvb21GYWN0b3IpICsgMV07Cgl9CgoJdGhpcy51cGRhdGVQaXhlbFBvc2l0aW9uID0gZnVuY3Rpb24oZXZlbnQpIHsKCQlldmVudCA9IHByZVByb2Nlc3NFdmVudChldmVudCk7CgoJCXZhciBwaXhlbFBvcyA9IHZpZXdlci5nZXRQaXhlbFBvc2l0aW9uKGV2ZW50KTsKCQkocGl4ZWxQb3NbMF08MSB8fCBwaXhlbFBvc1sxXTwxIHx8IHBpeGVsUG9zWzBdPm9yaWdpbmFsV2lkdGggfHwgcGl4ZWxQb3NbMV0+b3JpZ2luYWxIZWlnaHQpID8gdmlld2VyLmNsZWFyU3RhdHVzRmllbGQoIlBvc2l0aW9uIikgOiB2aWV3ZXIudXBkYXRlU3RhdHVzRmllbGQoIlBvc2l0aW9uIiwgJygnK3BpeGVsUG9zKycpJyk7Cgl9CgoJdGhpcy5jbGVhclBpeGVsUG9zaXRpb24gPSBmdW5jdGlvbihldmVudCkgewoJCWV2ZW50ID0gcHJlUHJvY2Vzc0V2ZW50KGV2ZW50KTsKCgkJdmlld2VyLmNsZWFyU3RhdHVzRmllbGQoJ1Bvc2l0aW9uJyk7Cgl9CgovKiBIZWxwZXIgZnVuY3Rpb25zICovCgoJZ2V0V2luZG93U2l6ZSA9IGZ1bmN0aW9uKCkgewoJCXZhciB3aW5XID0gNjMwLCB3aW5IID0gNDYwOwoJCWlmIChib2R5ICYmIGJvZHkub2Zmc2V0V2lkdGgpIHsKCQkJd2luVyA9IGJvZHkuY2xpZW50V2lkdGg7CgkJCXdpbkggPSBib2R5LmNsaWVudEhlaWdodDsKCQl9CgkJcmV0dXJuIFt3aW5XLHdpbkhdOwoJfQoKCWdldE9iamVjdFhZID0gZnVuY3Rpb24ob2JqZWN0KSB7CgkJdmFyIGxlZnQgPSAwLCB0b3AgPSAwOwoJCWlmIChvYmplY3Qub2Zmc2V0UGFyZW50KQoJCQlkbyB7CgkJCQlsZWZ0ICs9IG9iamVjdC5vZmZzZXRMZWZ0OwoJCQkJdG9wICs9IG9iamVjdC5vZmZzZXRUb3A7CgkJCX0KCQkJd2hpbGUgKG9iamVjdCA9IG9iamVjdC5vZmZzZXRQYXJlbnQpOwoJCXJldHVybiBbbGVmdCwgdG9wXTsKCX0KCglnZXRNb3VzZVhZID0gZnVuY3Rpb24oZXZlbnQpIHsKCQl2YXIgcG9zWCA9IDAsIHBvc1kgPSAwOwoJCWlmICghZXZlbnQpIGV2ZW50ID0gd2luZG93LmV2ZW50OwkvL2ZpcmVmb3gKCQlpZiAoZXZlbnQucGFnZVggfHwgZXZlbnQucGFnZVkpIHsKCQkJcG9zWCA9IGV2ZW50LnBhZ2VYOwoJCQlwb3NZID0gZXZlbnQucGFnZVk7CgkJfQoJCWVsc2UgaWYgKGV2ZW50LmNsaWVudFggfHwgZXZlbnQuY2xpZW50WSkgewkvL0lFCgkJCXBvc1ggPSBldmVudC5jbGllbnRYICsgZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0CgkJCQkrIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxMZWZ0OwoJCQlwb3NZID0gZXZlbnQuY2xpZW50WSArIGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wCgkJCQkrIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3A7CgkJfQoJCXJldHVybiBbcG9zWCxwb3NZXTsKCX0KCglzdHJpcFVuaXRzID0gZnVuY3Rpb24oc3RyaW5nLCB1bml0cykgewoJCWlmKHR5cGVvZiBzdHJpbmc9PSdudW1iZXInKQoJCQlyZXR1cm4gc3RyaW5nOwoJCXZhciByZXN1bHQgPSBzdHJpbmcuaW5kZXhPZih1bml0cyk7CgkJcmV0dXJuIHBhcnNlSW50KHN0cmluZy5zdWJzdHJpbmcoMCwgKHJlc3VsdCE9LTEpID8gcmVzdWx0IDogc3RyaW5nLmxlbmd0aCkpOwoJfQoKLyogVXNlciBhY3Rpb25zICovCgoJLy8gZnJhbWUgbmF2aWdhdGlvbgoJdGhpcy5maXJzdEZyYW1lID0gZnVuY3Rpb24oKSB7CgkJdmlld2VyLnNldEZyYW1lKDEpOwoJfQoJdGhpcy5wcmV2RnJhbWUgPSBmdW5jdGlvbigpIHsKCQl2aWV3ZXIuc2V0RnJhbWUoY3VycmVudEZyYW1lLTEpOwoJfQoJdGhpcy5uZXh0RnJhbWUgPSBmdW5jdGlvbigpIHsKCQl2aWV3ZXIuc2V0RnJhbWUoY3VycmVudEZyYW1lKzEpOwoJfQoJdGhpcy5sYXN0RnJhbWUgPSBmdW5jdGlvbigpIHsKCQl2aWV3ZXIuc2V0RnJhbWUobnVtYmVyT2ZGcmFtZXMpOwoJfQoJLy8gem9vbWluZwoJdGhpcy56b29tSW4gPSBmdW5jdGlvbigpIHsKCQl2aWV3ZXIuem9vbSgrMSwgY2FudmFzLmNsaWVudFdpZHRoLzIsIGNhbnZhcy5jbGllbnRIZWlnaHQvMik7Cgl9Cgl0aGlzLnpvb21PdXQgPSBmdW5jdGlvbigpIHsKCQl2aWV3ZXIuem9vbSgtMSwgY2FudmFzLmNsaWVudFdpZHRoLzIsIGNhbnZhcy5jbGllbnRIZWlnaHQvMik7Cgl9Cgl0aGlzLm9yaWdpbmFsU2l6ZSA9IGZ1bmN0aW9uKCkgewoJCXZpZXdlci56b29tVG8oMCwgY2FudmFzLmNsaWVudFdpZHRoLzIsIGNhbnZhcy5jbGllbnRIZWlnaHQvMik7Cgl9Cgl0aGlzLmF1dG9maXRJbWFnZSA9IGZ1bmN0aW9uKCkgewoJCXZpZXdlci5yZXNldFpvb20oKTsKCX0KCS8vIGhlbHAKCXRoaXMuc2hvd0hlbHAgPSBmdW5jdGlvbigpIHsKCQloZWxwLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwoJfQoJdGhpcy5oaWRlSGVscCA9IGZ1bmN0aW9uKCkgewoJCWhlbHAuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCX0KCi8qIE1vdXNlIGFuZCBrZXlib2FyZCBhY3Rpb25zICovCgoJc2V0VXBNb3VzZVdoZWVsQWN0aW9uID0gZnVuY3Rpb24oYWN0aW9uKSB7CgkJaWYgKGJvZHkuYWRkRXZlbnRMaXN0ZW5lcikgewogICAgCS8vIElFOSwgQ2hyb21lLCBTYWZhcmksIE9wZXJhCiAgICAJYm9keS5hZGRFdmVudExpc3RlbmVyKCJtb3VzZXdoZWVsIiwgYWN0aW9uLCBmYWxzZSk7CiAgCSAgLy8gRmlyZWZveAogICAgCWJvZHkuYWRkRXZlbnRMaXN0ZW5lcigiRE9NTW91c2VTY3JvbGwiLCBhY3Rpb24sIGZhbHNlKTsKICAgIH0KICAgIC8vIElFIDYvNy84CiAgICBlbHNlIGJvZHkuYXR0YWNoRXZlbnQoIm9ubW91c2V3aGVlbCIsIGFjdGlvbik7Cgl9CgoJcHJlUHJvY2Vzc0V2ZW50ID0gZnVuY3Rpb24oZSkgewoJCWlmICghZSkgLy9Gb3IgSUUKCQkJZSA9IHdpbmRvdy5ldmVudCwgZS5yZXR1cm5WYWx1ZSA9IGZhbHNlOwoJCWVsc2UgaWYgKGUucHJldmVudERlZmF1bHQpCgkJCWUucHJldmVudERlZmF1bHQoKTsKCgkJcmV0dXJuIGU7Cgl9CgoJdGhpcy5vbm1vdXNld2hlZWwgPSBmdW5jdGlvbihldmVudCkgewoJCWV2ZW50ID0gcHJlUHJvY2Vzc0V2ZW50KGV2ZW50KTsKCgkJdmFyIGRpcmVjdGlvbiA9IDA7IC8vIHVwIGlzICssIGRvd24gaXMgLQoKCQlpZiAoZXZlbnQud2hlZWxEZWx0YSkgCS8vIElFICYgQ2hyb21lCgkJCWRpcmVjdGlvbiA9IChldmVudC53aGVlbERlbHRhID4gMSkgPyAxIDogLTE7CgkJZWxzZSBpZiAoZXZlbnQuZGV0YWlsKSAvLyBGRiAmIE9wZXJhCgkJCWRpcmVjdGlvbiA9IChldmVudC5kZXRhaWwgPCAxKSA/IDEgOiAtMTsKCgkJdmFyIG1vdXNlUG9zID0gZ2V0TW91c2VYWShldmVudCk7CgkJdmFyIGNhbnZhc1BvcyA9IGdldE9iamVjdFhZKGNhbnZhcyk7CgkJdmlld2VyLnpvb20oZGlyZWN0aW9uLCBtb3VzZVBvc1swXS1jYW52YXNQb3NbMF0sIG1vdXNlUG9zWzFdLWNhbnZhc1Bvc1sxXSk7CgoJCXJldHVybiBmYWxzZTsKCX0KCgl0aGlzLmdyYWJJbWFnZSA9ICBmdW5jdGlvbihldmVudCkgewoJCWV2ZW50ID0gcHJlUHJvY2Vzc0V2ZW50KGV2ZW50KTsKCgkJLy8gc2V0IG1vdXNlIGN1cnNvcgoJCXZhciBpbWFnZVNpemUgPSBbaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodF0sIGNhbnZhc1NpemUgPSBbY2FudmFzLmNsaWVudFdpZHRoLCBjYW52YXMuY2xpZW50SGVpZ2h0XTsKCQl2YXIgY3Vyc29yID0gJ2Nyb3NzaGFpcic7CgkJaWYoaW1hZ2VTaXplWzBdPmNhbnZhc1NpemVbMF0gJiYgaW1hZ2VTaXplWzFdPmNhbnZhc1NpemVbMV0pCgkJCWN1cnNvciA9ICdtb3ZlJzsKCQllbHNlIGlmKGltYWdlU2l6ZVswXT5jYW52YXNTaXplWzBdKQoJCQljdXJzb3IgPSAnZS1yZXNpemUnOwoJCWVsc2UgaWYoaW1hZ2VTaXplWzFdPmNhbnZhc1NpemVbMV0pCgkJCWN1cnNvciA9ICduLXJlc2l6ZSc7CgoJCWltYWdlLnN0eWxlLmN1cnNvciA9IGN1cnNvcjsKCQlwcmV2aW91c01vdXNlUG9zaXRpb24gPSBnZXRNb3VzZVhZKGV2ZW50KTsKCQlpbWFnZS5vbm1vdXNlbW92ZSA9IHZpZXdlci5kcmFnSW1hZ2U7Cgl9CgoJdGhpcy5yZWxlYXNlSW1hZ2UgPSBmdW5jdGlvbihldmVudCkgewoJCWV2ZW50ID0gcHJlUHJvY2Vzc0V2ZW50KGV2ZW50KTsKCgkJaW1hZ2Uuc3R5bGUuY3Vyc29yID0gJ2Nyb3NzaGFpcic7CgkJaW1hZ2Uub25tb3VzZW1vdmUgPSBudWxsOwoJfQoKCXRoaXMuZHJhZ0ltYWdlID0gZnVuY3Rpb24oZXZlbnQpIHsKCQlldmVudCA9IHByZVByb2Nlc3NFdmVudChldmVudCk7CgoJCXZhciBtb3VzZVBvc2l0aW9uID0gZ2V0TW91c2VYWShldmVudCk7CgkJdmlld2VyLm1vdmVJbWFnZShtb3VzZVBvc2l0aW9uWzBdLXByZXZpb3VzTW91c2VQb3NpdGlvblswXSwgbW91c2VQb3NpdGlvblsxXS1wcmV2aW91c01vdXNlUG9zaXRpb25bMV0pOwoJCXByZXZpb3VzTW91c2VQb3NpdGlvbiA9IG1vdXNlUG9zaXRpb247Cgl9CgoJdGhpcy5vbmtleWRvd24gPSBmdW5jdGlvbihldmVudCkgewoKCQlldmVudCA9IHByZVByb2Nlc3NFdmVudChldmVudCk7CgkJdmFyIGtleUNvZGUgPSBldmVudC53aGljaCB8fCBldmVudC5rZXlDb2RlOwoKCQl2YXIgc2hpZnQgPSBbMCwgMF07CgoJCXN3aXRjaChrZXlDb2RlKXsKCgkJLy8gYnJvd3NpbmcKCQkJLy8gbmV4dCBmcmFtZQoJCQljYXNlIDMzOiAvLyBQYWdlVXAKCQkJY2FzZSAxOTA6IC8vIC4gPgoJCQkJdmlld2VyLm5leHRGcmFtZSgpOwoJCQkJYnJlYWs7CgkJCS8vIHByZXZpb3VzIGZyYW1lCgkJCWNhc2UgMzQ6IC8vIFBhZ2VEb3duCgkJCWNhc2UgMTg4OiAvLyAsIDwKCQkJCXZpZXdlci5wcmV2RnJhbWUoKTsKCQkJCWJyZWFrOwoJCQkvLyBsYXN0IGZyYW1lCgkJCWNhc2UgMzU6IC8vIEVuZAoJCQljYXNlIDE5MTogLy8gLyA/CgkJCQl2aWV3ZXIubGFzdEZyYW1lKCk7CgkJCQlicmVhazsKCQkJLy8gZmlyc3QgZnJhbWUKCQkJY2FzZSAzNjogLy8gSG9tZQoJCQljYXNlIDc3OiAvLyBtCgkJCQl2aWV3ZXIuZmlyc3RGcmFtZSgpOwoJCQkJYnJlYWs7CgkJLy8gem9vbWluZwoJCQkvLyB6b29tIGluCgkJCWNhc2UgODg6IC8vIHgKCQkJY2FzZSA0MzogLy8gKyAvIE51bXBhZCArCgkJCWNhc2UgNjE6CgkJCWNhc2UgMTA3OgoJCQljYXNlIDE4NzoKCQkJCXZpZXdlci56b29tSW4oKTsKCQkJCWJyZWFrOwoJCQkvLyB6b29tIG91dAoJCQljYXNlIDkwOiAvLyB6CgkJCWNhc2UgNDU6IC8vIC0gLyBOdW1wYWQgLQoJCQljYXNlIDEwOToKCQkJY2FzZSAxNzM6CgkJCWNhc2UgMTg5OgoJCQkJdmlld2VyLnpvb21PdXQoKTsKCQkJCWJyZWFrOwoJCQkvLyByZXNldCB6b29tIHRvIDEwMCUKCQkJY2FzZSA4MjogLy8gcgoJCQljYXNlIDg6IC8vIEJhY2tzcGFjZQoJCQkJdmlld2VyLm9yaWdpbmFsU2l6ZSgpOwoJCQkJYnJlYWs7CgkJCS8vIGZpdC1pbgoJCQljYXNlIDMyOiAvLyBTcGFjZQoJCQljYXNlIDEzOiAvLyBFbnRlcgoJCQkJdmlld2VyLmF1dG9maXRJbWFnZSgpOwoJCQkJYnJlYWs7CgkJLy8gbW92aW5nCgkJCWNhc2UgMzc6IC8vIExlZnQgYXJyb3cKCQkJCXNoaWZ0WzBdICs9IGN1cnJlbnRNb3VzZVNwZWVkOwoJCQkJYnJlYWs7CgkJCWNhc2UgMzg6IC8vIFVwIGFycm93CgkJCQlzaGlmdFsxXSArPSBjdXJyZW50TW91c2VTcGVlZDsKCQkJCWJyZWFrOwoJCQljYXNlIDM5OiAvLyBSaWdodCBhcnJvdwoJCQkJc2hpZnRbMF0gLT0gY3VycmVudE1vdXNlU3BlZWQ7CgkJCQlicmVhazsKCQkJY2FzZSA0MDogLy8gRG93biBhcnJvdwoJCQkJc2hpZnRbMV0gLT0gY3VycmVudE1vdXNlU3BlZWQ7CgkJCQlicmVhazsKCQkvLyBoZWxwCgkJCS8vIHNob3cKCQkJY2FzZSA3MjogLy8gaAoJCQkJdmlld2VyLnNob3dIZWxwKCk7CgkJCQlicmVhazsKCQkJLy8gaGlkZQoJCQljYXNlIDI3OiAvLyBFc2MKCQkJY2FzZSA4MTogLy8gcQoJCQkJdmlld2VyLmhpZGVIZWxwKCk7CgkJCQlicmVhazsKCQkvLyBkZWJ1ZwoJCQljYXNlIDY4OiAvLyBkCgkJCQlicmVhazsKCQl9CgoJCWlmKCBrZXlDb2RlPj0zNyAmJiBrZXlDb2RlPD00MCl7IC8vIHdoZW4gbW92aW5nCgkJCXZpZXdlci5tb3ZlSW1hZ2Uoc2hpZnRbMF0sIHNoaWZ0WzFdKTsKCQkJY3VycmVudE1vdXNlU3BlZWQgKz0gYmFzZU1vdXNlU3BlZWQ7CgkJfQoJfQoKCXRoaXMub25rZXl1cCA9IGZ1bmN0aW9uKGV2ZW50KSB7CgkJY3VycmVudE1vdXNlU3BlZWQgPSBiYXNlTW91c2VTcGVlZDsKCX0KCi8qIERPTSBlbGVtZW50cyBjcmVhdGlvbiAqLwoKCWNyZWF0ZUVsZW1lbnQgPSBmdW5jdGlvbih0eXBlLCBjbGFzc05hbWUsIHBhcmVudCkgewoJCXZhciBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0eXBlKTsKCQllbGVtZW50LmNsYXNzTmFtZSA9ICJlYmltYWdlLSIgKyBjbGFzc05hbWU7CgkJcGFyZW50LmFwcGVuZENoaWxkKGVsZW1lbnQpOwoJCXJldHVybiBlbGVtZW50OwoJfQoKCWNyZWF0ZUJ1dHRvbiA9IGZ1bmN0aW9uKG5hbWUsIHZhbHVlLCB0aXRsZSwgb25jbGljaywgZ3JvdXApIHsKCQl2YXIgYnV0dG9uID0gY3JlYXRlRWxlbWVudCgnYnV0dG9uJywgImJ1dHRvbiIsIGdyb3VwKTsKCQlidXR0b24uY2xhc3NOYW1lICs9ICIgYnRuLSIgKyBuYW1lOwoJCWJ1dHRvbi5pbm5lckhUTUwgPSB2YWx1ZTsKCQlidXR0b24udGl0bGUgPSB0aXRsZTsKCQlidXR0b24ub25jbGljayA9IG9uY2xpY2s7CgkJYnV0dG9uLmRpc2FibGUgPSBmdW5jdGlvbihkaXNhYmxlKXt0aGlzLmRpc2FibGVkPWRpc2FibGU7IHRoaXMuYmx1cigpOyByZXR1cm4gdGhpczt9OwoJCXJldHVybiAoYnV0dG9uc1tuYW1lXSA9IGJ1dHRvbik7Cgl9CgogIGNyZWF0ZU5hdkJ1dHRvbiA9IGZ1bmN0aW9uKG5hbWUsIHRpdGxlLCBvbmNsaWNrKSB7CgkJdmFyIGJ1dHRvbiA9IGNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicsICJidXR0b24iLCBuYXZidXR0b25zKTsKCQlidXR0b24uY2xhc3NOYW1lICs9ICIgYnRuLSIgKyBuYW1lOwoJCWJ1dHRvbi50aXRsZSA9IHRpdGxlOwoJCWJ1dHRvbi5vbmNsaWNrID0gb25jbGljazsKCQlidXR0b24uZGlzYWJsZSA9IGZ1bmN0aW9uKGRpc2FibGUpIHsKCQkgIHRoaXMuZGlzYWJsZWQgPSBkaXNhYmxlOwoJCSAgdGhpcy5pbm5lckhUTUwgPSBkaXNhYmxlID8gbmF2RGlzYWJsZWRbbmFtZV0gOiBuYXZFbmFibGVkW25hbWVdOwoJCSAgdGhpcy5ibHVyKCk7CgkJICByZXR1cm4gdGhpczsKCQl9OwoJCXJldHVybiAoYnV0dG9uc1tuYW1lXSA9IGJ1dHRvbik7Cgl9CgoJY3JlYXRlU3RhdHVzRmllbGQgPSBmdW5jdGlvbihuYW1lKSB7CgkgIHZhciBzdGF0dXNGaWVsZCA9IGNyZWF0ZUVsZW1lbnQoJ2RpdicsICdzdGF0dXMgZWJpbWFnZScsIHN0YXR1c2JhcikKCSAgc3RhdHVzRmllbGQuY2xhc3NOYW1lICs9ICIgc3RzLSIgKyBuYW1lOwoJCXJldHVybiAoc3RhdHVzW25hbWVdID0gc3RhdHVzRmllbGQpOwoJfQoKLyogU2V0IGltYWdlICovCiAgdGhpcy5yZXNldCA9IGZ1bmN0aW9uKGltZywgd2lkdGgsIGhlaWdodCkgewogICAgaWYgKCEoaW1nIGluc3RhbmNlb2YgQXJyYXkpKSB7CiAgICAgICAgZGF0YSA9IFtpbWddOwogICAgICB9IGVsc2UgewogICAgICAgIGRhdGEgPSBpbWc7CiAgICAgIH0KCiAgICBudW1iZXJPZkZyYW1lcyA9IGRhdGEubGVuZ3RoOwoKICAgIG9yaWdpbmFsV2lkdGggCT0gd2lkdGg7CiAgCW9yaWdpbmFsSGVpZ2h0CT0gaGVpZ2h0OwoKICAJLy8gc2V0IHVwIGltYWdlCgkJdmlld2VyLnNldEZyYW1lKCk7CgkJaW1hZ2Uub25sb2FkID0gdmlld2VyLnJlc2V0Q2FudmFzKCk7CgoJCXZpZXdlci51cGRhdGVTdGF0dXNGaWVsZCgiSW1hZ2UiLCBvcmlnaW5hbFdpZHRoKyd4JytvcmlnaW5hbEhlaWdodCk7CiAgfQoKLyogVmlld2VyIGluaXRpYWxpemF0aW9uICovCgl0aGlzLmluaXQgPSBmdW5jdGlvbigpIHsKCgkJLy8gY3JlYXRlIHRvb2xiYXIKCQl0b29sYmFyID0gY3JlYXRlRWxlbWVudCgnZGl2JywgJ3Rvb2xiYXIgZWJpbWFnZScsIGJvZHkpOwoJCS8vIGNyZWF0ZSBidXR0b24gY29udGFpbmVycwoJCW5hdmJ1dHRvbnMgPSBjcmVhdGVFbGVtZW50KCdkaXYnLCAnYnV0dG9ucy1uYXYgZWJpbWFnZScsIHRvb2xiYXIpOwoJCXpvb21idXR0b25zID0gY3JlYXRlRWxlbWVudCgnZGl2JywgJ2J1dHRvbnMtem9vbSBlYmltYWdlJywgdG9vbGJhcik7CgoJCS8vIGNyZWF0ZSBuYXZpZ2F0aW9uIGJ1dHRvbnMKCQljcmVhdGVOYXZCdXR0b24oJ2ZpcnN0JywnRmlyc3QgZnJhbWUgW0hPTUVdL1ttXSAnLHZpZXdlci5maXJzdEZyYW1lKTsKCQljcmVhdGVOYXZCdXR0b24oJ3ByZXYnLCdQcmV2aW91cyBmcmFtZSBbUEFHRSBET1dOXS9bPF0nLHZpZXdlci5wcmV2RnJhbWUpOwoJCWNyZWF0ZU5hdkJ1dHRvbignbmV4dCcsJ05leHQgZnJhbWUgW1BBR0UgVVBdL1s+XScsdmlld2VyLm5leHRGcmFtZSk7CgkJY3JlYXRlTmF2QnV0dG9uKCdsYXN0JywnTGFzdCBmcmFtZSBbRU5EXS9bP10nLHZpZXdlci5sYXN0RnJhbWUpOwoKCQkvLyBjcmVhdGUgem9vbSBidXR0b25zCgkJY3JlYXRlQnV0dG9uKCdpbicsJysnLCdab29tIGluIFsrXS9beF0nLCB2aWV3ZXIuem9vbUluLCB6b29tYnV0dG9ucyk7CgkJY3JlYXRlQnV0dG9uKCdvdXQnLCcmIzg3MjI7JywnWm9vbSBvdXQgWy1dL1t6XScsdmlld2VyLnpvb21PdXQsIHpvb21idXR0b25zKTsKCQljcmVhdGVCdXR0b24oJ29yZycsJzE6MScsJ09yaWdpbmFsIHNpemUgW0JBQ0tTUEFDRV0vW3JdJyx2aWV3ZXIub3JpZ2luYWxTaXplLCB6b29tYnV0dG9ucyk7CgkJY3JlYXRlQnV0dG9uKCdmaXQnLCcmIzg3Mjc7PGJyLz4mbmJzcDsnLCdGaXQgaW1hZ2UgW1NQQUNFXS9bRU5URVJdJyx2aWV3ZXIuYXV0b2ZpdEltYWdlLCB6b29tYnV0dG9ucyk7CgoJCS8vIGNyZWF0ZSBjYW52YXMKCQljYW52YXMgPSBjcmVhdGVFbGVtZW50KCdkaXYnLCAnY2FudmFzIGViaW1hZ2UnLCBib2R5KQoKCQkvL2NyZWF0ZSBzdGF0dXNiYXIKCQlzdGF0dXNiYXIgPSBjcmVhdGVFbGVtZW50KCdkaXYnLCAnc3RhdHVzYmFyIGViaW1hZ2UnLCBib2R5KTsKCgkJLy8gY3JlYXRlIHN0YXR1c2JhciBlbGVtZW50cwoJCWNyZWF0ZVN0YXR1c0ZpZWxkKCJJbWFnZSIpLCBjcmVhdGVTdGF0dXNGaWVsZCgiRnJhbWUiKSwgY3JlYXRlU3RhdHVzRmllbGQoIlpvb20iKSwgY3JlYXRlU3RhdHVzRmllbGQoIlBvc2l0aW9uIik7CgoJCS8vIGNyZWF0ZSBoZWxwCgkJaGVscCA9IGNyZWF0ZUVsZW1lbnQoJ2RpdicsICdoZWxwIGViaW1hZ2UnLCBjYW52YXMpCgkJaGVscC5pbm5lckhUTUwgPSAnPHRhYmxlIGNsYXNzPSJlYmltYWdlLWhlbHAtdGFibGUiPjx0cj48dGQgY29sc3Bhbj0iMyIgY2xhc3M9ImViaW1hZ2UtaGVscC10b3BpYyI+QnJvd3Npbmc8L3RkPjwvdHI+PHRyPjx0ZCBjb2xzcGFuPSIzIj5Vc2UgdG9vbGJhciBidXR0b25zIG9yIHRoZSBmb2xsb3dpbmcga2V5cyB0byBjaGFuZ2UgYmV0d2VlbiB0aGUgZnJhbWVzOjwvdGQ+PC90cj48dHI+PHRkPk5leHQgZnJhbWU8L3RkPjx0ZCBjbGFzcz0iZWJpbWFnZS1oZWxwLWtleSI+UEFHRSBVUDwvdGQ+PHRkIGNsYXNzPSJlYmltYWdlLWhlbHAta2V5Ij4mZ3Q8L3RkPjwvdHI+PHRyPjx0ZD5QcmV2aW91cyBmcmFtZTwvdGQ+PHRkIGNsYXNzPSJlYmltYWdlLWhlbHAta2V5Ij5QQUdFIERPV048L3RkPjx0ZCBjbGFzcz0iZWJpbWFnZS1oZWxwLWtleSI+Jmx0PC90ZD48L3RyPjx0cj48dGQ+Rmlyc3QgZnJhbWU8L3RkPjx0ZCBjbGFzcz0iZWJpbWFnZS1oZWxwLWtleSI+SE9NRTwvdGQ+PHRkIGNsYXNzPSJlYmltYWdlLWhlbHAta2V5Ij5NPC90ZD48L3RyPjx0cj48dGQ+TGFzdCBmcmFtZTwvdGQ+PHRkIGNsYXNzPSJlYmltYWdlLWhlbHAta2V5Ij5FTkQ8L3RkPjx0ZCBjbGFzcz0iZWJpbWFnZS1oZWxwLWtleSI+PzwvdGQ+PC90cj48dHI+PHRkIGNvbHNwYW49IjMiIGNsYXNzPSJlYmltYWdlLWhlbHAtdG9waWMiPlpvb21pbmc8L3RkPjwvdHI+PHRyPjx0ZCBjb2xzcGFuPSIzIj5UbyB6b29tIHRoZSBpbWFnZSBpbi9vdXQgdXNlIHRoZSBtb3VzZSB3aGVlbCwgdGhlIHRvb2xiYXIgYnV0dG9ucywgb3IgdGhlIGZvbGxvd2luZyBrZXlib2FyZCBzaG9ydGN1dHM6PC90ZD48L3RyPjx0cj48dGQ+Wm9vbSBpbjwvdGQ+PHRkIGNsYXNzPSJlYmltYWdlLWhlbHAta2V5Ij4rPC90ZD48dGQgY2xhc3M9ImViaW1hZ2UtaGVscC1rZXkiPng8L3RkPjwvdHI+PHRyPjx0ZD5ab29tIG91dDwvdGQ+PHRkIGNsYXNzPSJlYmltYWdlLWhlbHAta2V5Ij4tPC90ZD48dGQgY2xhc3M9ImViaW1hZ2UtaGVscC1rZXkiPno8L3RkPjwvdHI+PHRyPjx0ZD5SZXNldCB0byAxMDAlPC90ZD48dGQgY2xhc3M9ImViaW1hZ2UtaGVscC1rZXkiPkJBQ0tTUEFDRTwvdGQ+PHRkIGNsYXNzPSJlYmltYWdlLWhlbHAta2V5Ij5SPC90ZD48L3RyPjx0cj48dGQ+Rml0LWluPC90ZD48dGQgY2xhc3M9ImViaW1hZ2UtaGVscC1rZXkiPlNQQUNFPC90ZD48dGQgY2xhc3M9ImViaW1hZ2UtaGVscC1rZXkiPkVOVEVSPC90ZD48L3RyPjx0cj48dGQgY29sc3Bhbj0iMyIgY2xhc3M9ImViaW1hZ2UtaGVscC10b3BpYyI+UGFubmluZzwvdGQ+PC90cj48dHI+PHRkIGNvbHNwYW49IjMiPlRvIHBhbiB0aGUgaW1hZ2UgY2xpY2sgb24gaXQgYW5kIGRyYWcgaXQgd2l0aCB5b3VyIG1vdXNlLiBBbHRlcm5hdGl2ZWx5LCB1c2UgdGhlIGFycm93IGtleXMgb24geW91ciBrZXlib2FyZC48L3RkPjwvdHI+PHRyPjx0ZCBjb2xzcGFuPSIzIiBjbGFzcz0iZWJpbWFnZS1oZWxwLWNsb3NlIj5QcmVzcyBFU0Mgb3IgUSB0byBjbG9zZSB0aGlzIHdpbmRvdy48L3RkPjwvdHI+PC90YWJsZT4nCgoJCS8vIGNyZWF0ZSBpbWFnZQoJCWltYWdlID0gY3JlYXRlRWxlbWVudCgnaW1nJywgJ2ltYWdlIGViaW1hZ2UnLCBjYW52YXMpOwoKCQkvLyBzZXQgdXAgbW91c2UgYW5kIGtleWJvYXJkIGFjdGlvbnMKCQkvLyB1c2UgbW91c2V3aGVlbCBmb3Igem9vbWluZwogICAgc2V0VXBNb3VzZVdoZWVsQWN0aW9uKHZpZXdlci5vbm1vdXNld2hlZWwpOwoKCQkvLyBncmFiIGFuZCBwYW4gaW1hZ2Ugb24gY2xpY2sKCQlpbWFnZS5vbm1vdXNlZG93biA9IHZpZXdlci5ncmFiSW1hZ2U7CgkJaW1hZ2Uub25tb3VzZXVwID0gaW1hZ2Uub25tb3VzZW91dCA9IHZpZXdlci5yZWxlYXNlSW1hZ2U7CgkJaW1hZ2Uub25tb3VzZW1vdmUgPSBudWxsOwoJCS8vIHJlYWQga2V5c3Ryb2tlcywgaHR0cDovL2pzZmlkZGxlLm5ldC9lckNFcS8xNzMvCgkJYm9keS50YWJJbmRleCA9IDA7CgkJYm9keS5zdHlsZS5vdXRsaW5lID0gIm5vbmUiOwoJCWJvZHkub25tb3VzZW92ZXIgPSBmdW5jdGlvbigpIHsgdGhpcy5mb2N1cygpOyB9OwogICAgYm9keS5vbm1vdXNlb3V0ID0gZnVuY3Rpb24oKSB7IHRoaXMuYmx1cigpOyB9OwogICAgYm9keS5vbmZvY3VzID0gZnVuY3Rpb24oKSB7IHRoaXMub25rZXlkb3duID0gdmlld2VyLm9ua2V5ZG93bjsgfTsKCQkvLyByZWFkIGN1cnJlbnQgcGl4ZWwgcG9zaXRpb24KCQljYW52YXMub25tb3VzZW1vdmUgPSB2aWV3ZXIudXBkYXRlUGl4ZWxQb3NpdGlvbjsKCQljYW52YXMub25tb3VzZW91dCA9IHZpZXdlci5jbGVhclBpeGVsUG9zaXRpb247CgoJCS8vIHJlc2V0IHZpZXcgb24gd2luZG93IHJlc2l6ZQoJCS8vd2luZG93Lm9ucmVzaXplID0gcmVzZXRDYW52YXM7Cgl9CgoJdGhpcy5vbmxvYWQgPSB2aWV3ZXIuaW5pdCgpOwp9Cg=="></script>
<script src="data:application/x-javascript;base64,SFRNTFdpZGdldHMud2lkZ2V0KHsKCiAgbmFtZTogJ2Rpc3BsYXlXaWRnZXQnLAoKICB0eXBlOiAnb3V0cHV0JywKCiAgZmFjdG9yeTogZnVuY3Rpb24oZWwsIHdpZHRoLCBoZWlnaHQpIHsKCiAgICB2YXIgdmlld2VyID0gbmV3IFZpZXdlcihlbC5pZCk7CgogICAgcmV0dXJuIHsKCiAgICAgIHJlbmRlclZhbHVlOiBmdW5jdGlvbih4KSB7CiAgICAgICAgdmlld2VyLnJlc2V0KHguZGF0YSwgeC53aWR0aCwgeC5oZWlnaHQpOwogICAgICB9LAoKICAgICAgcmVzaXplOiBmdW5jdGlvbih3aWR0aCwgaGVpZ2h0KSB7CiAgICAgICAgdmlld2VyLnJlc2V0Q2FudmFzKCk7CiAgICAgIH0KCiAgICB9OwogIH0KfSk7Cg=="></script>

</head>
<body style="background-color:white;">
<div id="htmlwidget_container">
  <div id="htmlwidget-af1e1f529c67f303f4c9" style="width:960px;height:500px;" class="displayWidget html-widget"></div>
</div>
<script type="application/json" data-for="htmlwidget-af1e1f529c67f303f4c9">{"x":{"data":"lib/2b985420742f-0/frame001.png","width":920,"height":920},"evals":[],"jsHooks":[]}</script>
<script type="application/htmlwidget-sizing" data-for="htmlwidget-af1e1f529c67f303f4c9">{"viewer":{"width":450,"height":350,"padding":0,"fill":true},"browser":{"width":960,"height":500,"padding":0,"fill":true}}</script>
</body>
</html>
